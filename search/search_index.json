{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"pycotem pycotem is a python package for working with crystal orientations in transmission electron microscopy. It provides 6 GUI tools to: determine orientation from diffraction patterns: diffraction determine orientation from Kikuchi patterns: kikuchi work with stereographic projections: stereoproj determine interface normal and direction from images: interface determine orientation relationship and misorientation between two crystals: misorientation display crystal projection on a plane and draw dichromatic patterns: crystal","title":"Home"},{"location":"#pycotem","text":"pycotem is a python package for working with crystal orientations in transmission electron microscopy. It provides 6 GUI tools to: determine orientation from diffraction patterns: diffraction determine orientation from Kikuchi patterns: kikuchi work with stereographic projections: stereoproj determine interface normal and direction from images: interface determine orientation relationship and misorientation between two crystals: misorientation display crystal projection on a plane and draw dichromatic patterns: crystal","title":"pycotem"},{"location":"contribute/","text":"Contributions, bug issues, requests and comments can be adressed directly or through pull-request on github. Authors F. Mompiou , with idea from RX Xie (Tsinghua Univ), J. Du (Tsinghua Univ.) and the contribution of G. Perret (Univ. Toulouse). License This project is licensed under the GPL-3.0 License.","title":"About"},{"location":"contribute/#authors","text":"F. Mompiou , with idea from RX Xie (Tsinghua Univ), J. Du (Tsinghua Univ.) and the contribution of G. Perret (Univ. Toulouse).","title":"Authors"},{"location":"contribute/#license","text":"This project is licensed under the GPL-3.0 License.","title":"License"},{"location":"crystal/","text":"crystal allows to display crystal projection on a plane and draw dichromatic patterns. Interface The interface is composed of a top bar menu, a plotting area to display the projection and a setting panel. Procedure Enter the Crystal Parameters , either from the input fields or from the structure menu Fill the Plane field and the Size of the crystal box (integer units of the lattice parameters). Enter the layers indices ( Layers numb. ) parallel to the projected plane according to the scheme n_0,n_1 n_0,n_1 , n n being the layer number. Press the Calculate button. You will be prompted to select the appropriate crystal structure. Text files such as cfc.txt describe the position of atoms in the unit cell. The format is: atom1 x1 y1 z1 ... atomn xn yn zn v1x v1y v1z ... vkx vky vkz with atomn is nth atom in the cell at coordinate xn, yn, zn and vkx,vky,vkz is the kth translation vector defining all the positions of atoms in the cell. Press the Draw button. Tick Atom type button to see the different atoms (label with different numbers) Tick Atom position button to see the coordinates Projection of 3 layers of the (1,1,1) (1,1,1) plane in an Al crystal Layout Change the Marker size and shape using the Square/circle button Zoom in, move and save the figure using the tool bar Dichromatic pattern A so-called dichromatic pattern is formed when two misoriented crystals are interpenetrated. The pattern is drawn according the usual convention: black and white crystals correspond to two different grains and different symbols to different layers (note that you can plot up to 7 different layers with different symbols). To draw it tick the enable box Enter a rotation angle between the two crystal along the plane normal. Recalculate (press Calculate ) and then Draw Tick the coincidence box to highlight coincident site positions. The precision by which is defined coincidence can be tuned in the precision field. It is expressed in % of the largest lattice parameter. Tick the layers button to show the layer number on the dichromatic pattern. From layers 0 to 5, markers are circles, squares, triangles, stars and hexagons, respectively. After they are all circles. Example of a dichromatic pattern in a (1,1,1) (1,1,1) plane with a misorientation angle of 38.21\u00b0, in Al.","title":"Crystal"},{"location":"crystal/#interface","text":"The interface is composed of a top bar menu, a plotting area to display the projection and a setting panel.","title":"Interface"},{"location":"crystal/#procedure","text":"Enter the Crystal Parameters , either from the input fields or from the structure menu Fill the Plane field and the Size of the crystal box (integer units of the lattice parameters). Enter the layers indices ( Layers numb. ) parallel to the projected plane according to the scheme n_0,n_1 n_0,n_1 , n n being the layer number. Press the Calculate button. You will be prompted to select the appropriate crystal structure. Text files such as cfc.txt describe the position of atoms in the unit cell. The format is: atom1 x1 y1 z1 ... atomn xn yn zn v1x v1y v1z ... vkx vky vkz with atomn is nth atom in the cell at coordinate xn, yn, zn and vkx,vky,vkz is the kth translation vector defining all the positions of atoms in the cell. Press the Draw button. Tick Atom type button to see the different atoms (label with different numbers) Tick Atom position button to see the coordinates Projection of 3 layers of the (1,1,1) (1,1,1) plane in an Al crystal","title":"Procedure"},{"location":"crystal/#layout","text":"Change the Marker size and shape using the Square/circle button Zoom in, move and save the figure using the tool bar","title":"Layout"},{"location":"crystal/#dichromatic-pattern","text":"A so-called dichromatic pattern is formed when two misoriented crystals are interpenetrated. The pattern is drawn according the usual convention: black and white crystals correspond to two different grains and different symbols to different layers (note that you can plot up to 7 different layers with different symbols). To draw it tick the enable box Enter a rotation angle between the two crystal along the plane normal. Recalculate (press Calculate ) and then Draw Tick the coincidence box to highlight coincident site positions. The precision by which is defined coincidence can be tuned in the precision field. It is expressed in % of the largest lattice parameter. Tick the layers button to show the layer number on the dichromatic pattern. From layers 0 to 5, markers are circles, squares, triangles, stars and hexagons, respectively. After they are all circles. Example of a dichromatic pattern in a (1,1,1) (1,1,1) plane with a misorientation angle of 38.21\u00b0, in Al.","title":"Dichromatic pattern"},{"location":"diffraction/","text":"diffraction allows to determine orientation from a set of diffraction patterns. Introduction Determining orientation from diffraction patterns requires to collect and identify a set of diffraction vectors \\vec{q} \\vec{q} . When using this approach, we assume that the diffraction vector is in Bragg condition, which is fulfill at least in a two beam orientation. This often needs to tilt the specimen. Alternatively we present in Kikuchi a method based on Kikuchi lines. Consider an electronic wave scattered by a crystal plane (h,k,l) (h,k,l) corresponding to a diffraction vector \\vec{q} \\vec{q} . Its amplitude and phase is given by: \\Psi(\\vec{q})=\\sum_{j=1}^N f_j e^{- 2i\\pi \\vec{q}\\cdot\\vec{r}_j} \\Psi(\\vec{q})=\\sum_{j=1}^N f_j e^{- 2i\\pi \\vec{q}\\cdot\\vec{r}_j} where the sum is made on all the atoms j j placed at \\vec{r}_j \\vec{r}_j in the unit cell. The intensity recorded is thus: I(\\vec{q})=\\Psi(\\vec{q})\\Psi^\\ast(\\vec{q}) I(\\vec{q})=\\Psi(\\vec{q})\\Psi^\\ast(\\vec{q}) For a given crystal, the wave intensity will depend both on the \\vec{q}\\cdot\\vec{r} \\vec{q}\\cdot\\vec{r} and on the atomic form factor f_j f_j . Systematic extinctions Extinctions for specific (h,k,l) (h,k,l) diffracted planes are expected if: $$ \\sum_{j=1}^N e^{- 2i\\pi (h \\cdot x_j + k \\cdot y_j + l \\cdot z_j)}=0 $$ For fcc cubic crystals, with atoms placed at (x_j,y_j,z_j)= (0, 0, 0), (0.5, 0.5, 0) ,(0, 0.5, 0.5), (0.5, 0, 0.5) (x_j,y_j,z_j)= (0, 0, 0), (0.5, 0.5, 0) ,(0, 0.5, 0.5), (0.5, 0, 0.5) , this condition is fulfilled when (h,k,l) (h,k,l) are of different parity The atomic form factor f_j f_j corresponds to the amplitude of the wave diffracting on a single atom. In the range of scattering vectors between 0\\leq q \\leq 25 \\mathring{A}^{-1} 0\\leq q \\leq 25 \\mathring{A}^{-1} , the atomic form factor can be approximated by a Gaussian decomposition: f(q)=\\sum _{i=1}^{4}a_{i}\\exp \\left(-b_{i}\\left({\\frac {q}{4\\pi }}\\right)^{2}\\right)+c f(q)=\\sum _{i=1}^{4}a_{i}\\exp \\left(-b_{i}\\left({\\frac {q}{4\\pi }}\\right)^{2}\\right)+c where the values of a_i a_i , b_i b_i , and c_i c_i can be found for every atoms for instance here The position and the name of atoms are defined in the space_group.txt file following the scheme: Name Atom name1 x1 y1 z1 Atom name1 x2 y2 z2 ... Atom name2 x3 y3 z3 The atomic factor is defined in the scattering.txt file according to the scheme: Atom name1 a1 b1 a2 b2 a3 b3 a4 b4 c ... Diffraction pattern in TEM When a plane electronic wave is scattered by a crystal under a given orientation, a spot diffraction pattern is formed in the back focal plane of the objective lens. The spots correspond to different diffraction vectors \\vec{q} \\vec{q} , the intensity of the pattern depending both on the crystal lattice and its orientation (see stereoproj ). In diffraction , we only use the structure factor as a guide to identify diffraction spots. Thus, an electron wave traveling in the direction -z -z will be diffracted by an angle \\theta_B \\theta_B given by the Bragg law: 2d \\sin{\\theta_B} = n \\lambda 2d \\sin{\\theta_B} = n \\lambda \\lambda \\lambda being the wavelength, d d the inter-reticular spacing and n n the diffraction order (corresponding to parallel diffraction vectors n(h,k,l) n(h,k,l) ). Diffracted spots will be located at a given distance r r from the transmitted beam and at a given angle \\eta \\eta from a fixed direction, chosen here as the y y axis. The observed/recorded pattern will depend on: the magnification due to intermediate and projection lenses. The distance r r measured will thus depend on the value of L L called the camera length, given by $$ L=\\frac{rd}{n\\lambda} $$ As a consequence, the pattern will depend on the acceleration voltage, through the wavelength. the rotation, by an angle \\xi \\xi , between the \\alpha \\alpha -tilt axis which defines the y y axis in the holder reference frame, and the y y axis on the pattern. Two-beam and three-beam conditions In a two-beam condition (left picture), only one diffraction vector is strongly excited. In that case \\vec{g} \\vec{g} is located on a sphere of radius 1/\\lambda 1/\\lambda , the Ewald sphere, corresponding to the exact Bragg condition ( s s , the deviation from this condition is zero). In that condition, the Kikuchi lines lie at (0,+\\vec{g}) (0,+\\vec{g}) . However, the diffraction planes are rotated of an angle \\theta_B \\theta_B with respect to the electron beam. This angle is usually small, but depend both on the acceleration voltage (through 1/\\lambda 1/\\lambda ) and the interplanar spacing ( d d ). At 200 kV, in iron austenite, \\theta_B \\approx 0.4^\\circ \\theta_B \\approx 0.4^\\circ for the (200) (200) vector. In a three-beam condition (right), the crystal is tilted by an angle \\theta_B \\theta_B from the two-beam conditions. Now the Kikuchi lines, are located between the transmitted beam and the diffracted beams. Three beams (0,-\\vec{g},\\vec{g}) (0,-\\vec{g},\\vec{g}) are equally excited and the planes are perpendicular to the electron beam. This corresponds to a situation where s=-\\lambda/2 \\|\\vec{g}\\|^2 s=-\\lambda/2 \\|\\vec{g}\\|^2 . A high accuracy of orientation thus needs the knowledge of s s , i.e. the position of the Kikuchi lines. Please refer to Kikuchi , for such analysis. When taking a diffraction pattern, it is thus recommended to fulfill the three-beam conditions, i.e. in the middle of the extinction contours in image mode. However better imaging conditions are reached in two-beam with s 0 s>0 . Pycotem allows to correct the orientation of a diffraction vector from a two-beam condition. See below. Calibration and operating conditions The diffraction pattern needs to be carefully calibrated on the microscope used. Use a crystal with known lattice parameters and record a diffraction pattern, ideally forming rows or a zone axis with a large value of n n . For every camera length and acceleration voltage, measure r r in pixels corresponding to d d in angstrom. The calibration are set in the calibration.txt file following the scheme: Microscope_name voltage camera length binning r.d ... For diffraction , only the value r . d r . d is necessary, the other fields are informative. Orientation from a set of diffraction vectors If a set of diffraction vectors are given, the orientation can be retrieved knowing the position of the vectors in the sample coordinates s s (see below regarding ambiguities). Given the direction X X in the crystal c c coordinates: G_c X = G_s \\begin{pmatrix} 1\\\\ 0 \\\\ 0 \\end{pmatrix} G_c X = G_s \\begin{pmatrix} 1\\\\ 0 \\\\ 0 \\end{pmatrix} where G_c=D^\\ast \\begin{pmatrix} h_1 k_1 l_1\\\\ ... \\\\ h_N k_N l_N \\end{pmatrix} G_c=D^\\ast \\begin{pmatrix} h_1 & k_1 & l_1\\\\ & ... & \\\\ h_N & k_N & l_N \\end{pmatrix} are the g-vectors in the crystal coordinates and D^\\ast D^\\ast is defined here , and: G_s=\\begin{pmatrix} x_1 y_1 z_1\\\\ ... \\\\ x_N y_N z_N \\end{pmatrix} G_s=\\begin{pmatrix} x_1 & y_1 & z_1\\\\ & ... & \\\\ x_N & y_N & z_N \\end{pmatrix} are the g-vectors in the sample coordinates. The coordinates x_i,y_i,z_i x_i,y_i,z_i are obtained by appropriate rotation in the sample coordinates. For a double tilt holder, with no angle between the vertical direction and the \\alpha \\alpha -tilt axis, the coordinates of the diffraction vector i i is 1 : \\begin{pmatrix} x_i\\\\ y_i \\\\ z_i \\end{pmatrix} = R_x(-\\beta_i) R_y(-\\alpha_i) R_z(-\\eta_i) \\begin{pmatrix} 0\\\\ 1 \\\\ 0 \\end{pmatrix} \\begin{pmatrix} x_i\\\\ y_i \\\\ z_i \\end{pmatrix} = R_x(-\\beta_i) R_y(-\\alpha_i) R_z(-\\eta_i) \\begin{pmatrix} 0\\\\ 1 \\\\ 0 \\end{pmatrix} Example of a tilt sequence in a double tilt holder. The recorded diffraction vector (1,1,1) (1,1,1) is obtained after rotating along x x of an angle \\beta=-20 \\beta=-20 , then along \\alpha=10 \\alpha=10 . The inclination made on diffraction pattern with the \\alpha \\alpha -tilt axis (here along the y y direction) is \\eta=40 \\eta=40 . The equations G_cX=G_s [1,0,0]^T \\\\ G_cY=G_s [0,1,0]^T \\\\ G_cZ =G_s [0,0,1]^T G_cX=G_s [1,0,0]^T \\\\ G_cY=G_s [0,1,0]^T \\\\ G_cZ =G_s [0,0,1]^T lead to: G_c A=G_s G_c A=G_s The above equation defines the crystal orientation, so that A A should be a rotation matrix. The closest Euler rotation matrix R R can be found with the approach proposed by Mackenzie 2 using singular value decomposition: U,S,V^T=svd(G_c^TG_s) \\\\ R=V U^T U,S,V^T=svd(G_c^TG_s) \\\\ R=V U^T The Euler angles are retrieved from the R R matrix: \\varphi_1 = \\arctan (R_{02}, R_{12}) \\\\ \\phi = \\arccos(R_{22}) \\\\ \\varphi_2 = \\arctan (R_{20},R_{21}) \\varphi_1 = \\arctan (R_{02}, R_{12}) \\\\ \\phi = \\arccos(R_{22}) \\\\ \\varphi_2 = \\arctan (R_{20},R_{21}) 180\u00b0 ambiguity When the inputs g-vectors are coplanar, the retrieved orientation may suffer the 180\u00b0 ambiguity. The situation described on the left side of the figure below is ambiguous. In this case, the 180\u00b0 rotation along g_3 g_3 leads two different crystal orientations. On the contrary, the right side of the figure is not ambiguous, as the 180\u00b0 rotation along (0\\bar{1}1) (0\\bar{1}1) is a crystal symmetry. Same ambiguities can arise when indexing zone axes that present a 180\u00b0 rotational symmetry which does not exist in the crystal. In diffraction ambiguous results can be detected. Interface The interface is composed of a top bar menu, a plotting area to display diffraction pattern and a setting/results panel. Procedure Defining the crystal structure Crystal structure can be imported from the structure menu. This menu can be populated by adding structures in the structure.txt files following the template: Name a(A) b(A) c(A) alpha beta gamma space group The space group is defined in the space_group.txt file and with the scattering.txt file as defined above. Alternatively, the structure can be set by filling the a,b,c a,b,c and \\alpha \\alpha , \\beta \\beta , \\gamma \\gamma fields. Workflow Open a diffraction pattern. Make sure that the file name does not contain non-ASCII character. Define a calibration in the Calibrations box Set the Diffraction alpha y-axis angle (see stereoproj ) Left click on a diffraction spot. Zoom in to ensure a higher precision. Click again on a second spot corresponding to the diffraction order n n . Indicate the order n n in the diffraction order field. Click reset view or reset point if needed The distance d d (A) and the inclination angle \\eta \\eta are indicated in the Dist, Inclination box. Option 1: computer-aided determination of (h,k,l) indices In most of case, the reflections indices can be determined unambiguously from their d-spacing. Indicate a value in px in the precision box. The g-vectors will be chosen within the uncertainty range \\pm \\pm the precision. By default, the value is 10 px. Select the d-spacing in the Dist, Inclination box. Click on Find diffraction spots to identify the spot . The results appear in the g vectors box with the scheme d(A) | h,k,l | Intensity(arb. units) | angles The angles values are explained below. The data (h,k,l) (h,k,l) , the inclination angle \\eta \\eta and the tilt angles, can be used to plot stereographic projection from a diffraction vector Thus for every diffraction patterns, the diffraction vector, inclination angle, and tilt angles need to be provided. Fill the tilt angles fields. Tick the box to indicate that rotation is anti-clockwise. Tick the 2-to-3 beams check box if a correction from a 2-beam to a 3-beam condition is required (see above ). This leads to the evaluation of the out of plane angle \\epsilon \\epsilon . Click and Find diffraction spots Select both the dist, inclination field and the appropriate g vector . For the first condition, the indices of the g-vector can arbitrary be chosen. Press Add data . A line appears alpha angle, beta angle, theta angle, inclination, h,k,l, epsilon angle . Data can be removed by selecting the line and by pressing Remove data . Repeat the above operations for at least 2 diffraction spots. For every conditions, the angle between the proposed g-vectors and the already chosen g-vectors are indicated. Choose the (h,k,l) (h,k,l) indices that minimize all the angles. Option 2: Automatic determination When the reflections are ambiguous from their d-spacing, consistent sets of data can be retrieved by comparing the measured angles \\theta_{ij}=\\angle{(\\vec{g}_i,\\vec{g}_j)} \\theta_{ij}=\\angle{(\\vec{g}_i,\\vec{g}_j)} with a lookup table compiling the angles \\theta'_{ij}=\\angle{((h_i,k_i,l_i),(h_j,k_j,l_j))} \\theta'_{ij}=\\angle{((h_i,k_i,l_i),(h_j,k_j,l_j))} . The sets of g-vectors are obtained if all the angles difference \\left|\\theta_{ij}-\\theta'_{ij}\\right| \\left|\\theta_{ij}-\\theta'_{ij}\\right| is less than a tolerance angle equals to 3 degrees. To proceed this way: Tick the do not use g-vector guess box. Add the spot as above. The indices will appear as 0,0,0 . Retrieve orientation Select the data lines and press Get orientation The result box shows: phi1, phi, phi2 (Euler angles) mean angular deviation, mean d-spacing deviation In case of option 2, the (hkl) (hkl) indices are indicated. Two sets of phi1, phi, phi2 angles are displayed if the results are ambiguous. The accuracy of the result is given by: The mean angular deviation , which is the average angle between each diffraction vector computed from the Euler angles and the experimental values: \\langle \\theta_d \\rangle = \\frac{1}{N}{\\sum_i^N \\left| \\arccos(R \\vec{g}_i \\cdot [x_i,y_i,z_i]^T) \\right|} \\langle \\theta_d \\rangle = \\frac{1}{N}{\\sum_i^N \\left| \\arccos(R \\vec{g}_i \\cdot [x_i,y_i,z_i]^T) \\right|} where \\vec{g}_i \\vec{g}_i is the normalized diffraction vector corresponding to the (h_i,k_i,l_i) (h_i,k_i,l_i) plane. The mean d-spacing deviation , in percents, is the mean spread between measured and expected d-spacings. It should be of typically less than 10/% \\langle d \\rangle= \\frac{1}{N}{\\sum_i^N \\left| \\frac{d_{hkl}-d_i}{d_{hkl}}\\right|} \\langle d \\rangle= \\frac{1}{N}{\\sum_i^N \\left| \\frac{d_{hkl}-d_i}{d_{hkl}}\\right|} In case of option 2, the results are sorted by ascending order of mean deviation angles and mean d-spacing. Import/Export data Using the Data menu, data can be imported and results exported. Data sets are provided in a .txt file using the following scheme # Diffraction data file alpha_1,beta_1,theta_1,eta_1,h_1,k_1,l_1,epsilon_1 ... alpha_N,beta_N,theta_N,eta_N,h_N,k_N,l_N,epsilon_N Exporting data will write in a .txt file, adding to the above datasets: # Results # Phi1,Phi,Phi2 # phi_1,phi, phi_2 # Mean angular deviation, Mean square angular dev. # ang_d, ang_d^2 The two files can be combined in one as # sign will not be read during import. Spectrum Spectra, i.e. peak intensity with respect to the d-spacing, can be plotted from the top menu. The maximum indices should be indicated. if the diffraction is taking away from the three-beam condition, an extra rotation R_x(\\epsilon) R_x(\\epsilon) applies, with \\epsilon = \\theta_B+s/\\|\\vec{g}\\|^2 \\epsilon = \\theta_B+s/\\|\\vec{g}\\|^2 . J. Mackenzie, Acta Cryst. 1957, 10, 61.","title":"Diffraction"},{"location":"diffraction/#introduction","text":"Determining orientation from diffraction patterns requires to collect and identify a set of diffraction vectors \\vec{q} \\vec{q} . When using this approach, we assume that the diffraction vector is in Bragg condition, which is fulfill at least in a two beam orientation. This often needs to tilt the specimen. Alternatively we present in Kikuchi a method based on Kikuchi lines. Consider an electronic wave scattered by a crystal plane (h,k,l) (h,k,l) corresponding to a diffraction vector \\vec{q} \\vec{q} . Its amplitude and phase is given by: \\Psi(\\vec{q})=\\sum_{j=1}^N f_j e^{- 2i\\pi \\vec{q}\\cdot\\vec{r}_j} \\Psi(\\vec{q})=\\sum_{j=1}^N f_j e^{- 2i\\pi \\vec{q}\\cdot\\vec{r}_j} where the sum is made on all the atoms j j placed at \\vec{r}_j \\vec{r}_j in the unit cell. The intensity recorded is thus: I(\\vec{q})=\\Psi(\\vec{q})\\Psi^\\ast(\\vec{q}) I(\\vec{q})=\\Psi(\\vec{q})\\Psi^\\ast(\\vec{q}) For a given crystal, the wave intensity will depend both on the \\vec{q}\\cdot\\vec{r} \\vec{q}\\cdot\\vec{r} and on the atomic form factor f_j f_j . Systematic extinctions Extinctions for specific (h,k,l) (h,k,l) diffracted planes are expected if: $$ \\sum_{j=1}^N e^{- 2i\\pi (h \\cdot x_j + k \\cdot y_j + l \\cdot z_j)}=0 $$ For fcc cubic crystals, with atoms placed at (x_j,y_j,z_j)= (0, 0, 0), (0.5, 0.5, 0) ,(0, 0.5, 0.5), (0.5, 0, 0.5) (x_j,y_j,z_j)= (0, 0, 0), (0.5, 0.5, 0) ,(0, 0.5, 0.5), (0.5, 0, 0.5) , this condition is fulfilled when (h,k,l) (h,k,l) are of different parity The atomic form factor f_j f_j corresponds to the amplitude of the wave diffracting on a single atom. In the range of scattering vectors between 0\\leq q \\leq 25 \\mathring{A}^{-1} 0\\leq q \\leq 25 \\mathring{A}^{-1} , the atomic form factor can be approximated by a Gaussian decomposition: f(q)=\\sum _{i=1}^{4}a_{i}\\exp \\left(-b_{i}\\left({\\frac {q}{4\\pi }}\\right)^{2}\\right)+c f(q)=\\sum _{i=1}^{4}a_{i}\\exp \\left(-b_{i}\\left({\\frac {q}{4\\pi }}\\right)^{2}\\right)+c where the values of a_i a_i , b_i b_i , and c_i c_i can be found for every atoms for instance here The position and the name of atoms are defined in the space_group.txt file following the scheme: Name Atom name1 x1 y1 z1 Atom name1 x2 y2 z2 ... Atom name2 x3 y3 z3 The atomic factor is defined in the scattering.txt file according to the scheme: Atom name1 a1 b1 a2 b2 a3 b3 a4 b4 c ...","title":"Introduction"},{"location":"diffraction/#diffraction-pattern-in-tem","text":"When a plane electronic wave is scattered by a crystal under a given orientation, a spot diffraction pattern is formed in the back focal plane of the objective lens. The spots correspond to different diffraction vectors \\vec{q} \\vec{q} , the intensity of the pattern depending both on the crystal lattice and its orientation (see stereoproj ). In diffraction , we only use the structure factor as a guide to identify diffraction spots. Thus, an electron wave traveling in the direction -z -z will be diffracted by an angle \\theta_B \\theta_B given by the Bragg law: 2d \\sin{\\theta_B} = n \\lambda 2d \\sin{\\theta_B} = n \\lambda \\lambda \\lambda being the wavelength, d d the inter-reticular spacing and n n the diffraction order (corresponding to parallel diffraction vectors n(h,k,l) n(h,k,l) ). Diffracted spots will be located at a given distance r r from the transmitted beam and at a given angle \\eta \\eta from a fixed direction, chosen here as the y y axis. The observed/recorded pattern will depend on: the magnification due to intermediate and projection lenses. The distance r r measured will thus depend on the value of L L called the camera length, given by $$ L=\\frac{rd}{n\\lambda} $$ As a consequence, the pattern will depend on the acceleration voltage, through the wavelength. the rotation, by an angle \\xi \\xi , between the \\alpha \\alpha -tilt axis which defines the y y axis in the holder reference frame, and the y y axis on the pattern. Two-beam and three-beam conditions In a two-beam condition (left picture), only one diffraction vector is strongly excited. In that case \\vec{g} \\vec{g} is located on a sphere of radius 1/\\lambda 1/\\lambda , the Ewald sphere, corresponding to the exact Bragg condition ( s s , the deviation from this condition is zero). In that condition, the Kikuchi lines lie at (0,+\\vec{g}) (0,+\\vec{g}) . However, the diffraction planes are rotated of an angle \\theta_B \\theta_B with respect to the electron beam. This angle is usually small, but depend both on the acceleration voltage (through 1/\\lambda 1/\\lambda ) and the interplanar spacing ( d d ). At 200 kV, in iron austenite, \\theta_B \\approx 0.4^\\circ \\theta_B \\approx 0.4^\\circ for the (200) (200) vector. In a three-beam condition (right), the crystal is tilted by an angle \\theta_B \\theta_B from the two-beam conditions. Now the Kikuchi lines, are located between the transmitted beam and the diffracted beams. Three beams (0,-\\vec{g},\\vec{g}) (0,-\\vec{g},\\vec{g}) are equally excited and the planes are perpendicular to the electron beam. This corresponds to a situation where s=-\\lambda/2 \\|\\vec{g}\\|^2 s=-\\lambda/2 \\|\\vec{g}\\|^2 . A high accuracy of orientation thus needs the knowledge of s s , i.e. the position of the Kikuchi lines. Please refer to Kikuchi , for such analysis. When taking a diffraction pattern, it is thus recommended to fulfill the three-beam conditions, i.e. in the middle of the extinction contours in image mode. However better imaging conditions are reached in two-beam with s 0 s>0 . Pycotem allows to correct the orientation of a diffraction vector from a two-beam condition. See below.","title":"Diffraction pattern in TEM"},{"location":"diffraction/#calibration-and-operating-conditions","text":"The diffraction pattern needs to be carefully calibrated on the microscope used. Use a crystal with known lattice parameters and record a diffraction pattern, ideally forming rows or a zone axis with a large value of n n . For every camera length and acceleration voltage, measure r r in pixels corresponding to d d in angstrom. The calibration are set in the calibration.txt file following the scheme: Microscope_name voltage camera length binning r.d ... For diffraction , only the value r . d r . d is necessary, the other fields are informative.","title":"Calibration and operating conditions"},{"location":"diffraction/#orientation-from-a-set-of-diffraction-vectors","text":"If a set of diffraction vectors are given, the orientation can be retrieved knowing the position of the vectors in the sample coordinates s s (see below regarding ambiguities). Given the direction X X in the crystal c c coordinates: G_c X = G_s \\begin{pmatrix} 1\\\\ 0 \\\\ 0 \\end{pmatrix} G_c X = G_s \\begin{pmatrix} 1\\\\ 0 \\\\ 0 \\end{pmatrix} where G_c=D^\\ast \\begin{pmatrix} h_1 k_1 l_1\\\\ ... \\\\ h_N k_N l_N \\end{pmatrix} G_c=D^\\ast \\begin{pmatrix} h_1 & k_1 & l_1\\\\ & ... & \\\\ h_N & k_N & l_N \\end{pmatrix} are the g-vectors in the crystal coordinates and D^\\ast D^\\ast is defined here , and: G_s=\\begin{pmatrix} x_1 y_1 z_1\\\\ ... \\\\ x_N y_N z_N \\end{pmatrix} G_s=\\begin{pmatrix} x_1 & y_1 & z_1\\\\ & ... & \\\\ x_N & y_N & z_N \\end{pmatrix} are the g-vectors in the sample coordinates. The coordinates x_i,y_i,z_i x_i,y_i,z_i are obtained by appropriate rotation in the sample coordinates. For a double tilt holder, with no angle between the vertical direction and the \\alpha \\alpha -tilt axis, the coordinates of the diffraction vector i i is 1 : \\begin{pmatrix} x_i\\\\ y_i \\\\ z_i \\end{pmatrix} = R_x(-\\beta_i) R_y(-\\alpha_i) R_z(-\\eta_i) \\begin{pmatrix} 0\\\\ 1 \\\\ 0 \\end{pmatrix} \\begin{pmatrix} x_i\\\\ y_i \\\\ z_i \\end{pmatrix} = R_x(-\\beta_i) R_y(-\\alpha_i) R_z(-\\eta_i) \\begin{pmatrix} 0\\\\ 1 \\\\ 0 \\end{pmatrix} Example of a tilt sequence in a double tilt holder. The recorded diffraction vector (1,1,1) (1,1,1) is obtained after rotating along x x of an angle \\beta=-20 \\beta=-20 , then along \\alpha=10 \\alpha=10 . The inclination made on diffraction pattern with the \\alpha \\alpha -tilt axis (here along the y y direction) is \\eta=40 \\eta=40 . The equations G_cX=G_s [1,0,0]^T \\\\ G_cY=G_s [0,1,0]^T \\\\ G_cZ =G_s [0,0,1]^T G_cX=G_s [1,0,0]^T \\\\ G_cY=G_s [0,1,0]^T \\\\ G_cZ =G_s [0,0,1]^T lead to: G_c A=G_s G_c A=G_s The above equation defines the crystal orientation, so that A A should be a rotation matrix. The closest Euler rotation matrix R R can be found with the approach proposed by Mackenzie 2 using singular value decomposition: U,S,V^T=svd(G_c^TG_s) \\\\ R=V U^T U,S,V^T=svd(G_c^TG_s) \\\\ R=V U^T The Euler angles are retrieved from the R R matrix: \\varphi_1 = \\arctan (R_{02}, R_{12}) \\\\ \\phi = \\arccos(R_{22}) \\\\ \\varphi_2 = \\arctan (R_{20},R_{21}) \\varphi_1 = \\arctan (R_{02}, R_{12}) \\\\ \\phi = \\arccos(R_{22}) \\\\ \\varphi_2 = \\arctan (R_{20},R_{21}) 180\u00b0 ambiguity When the inputs g-vectors are coplanar, the retrieved orientation may suffer the 180\u00b0 ambiguity. The situation described on the left side of the figure below is ambiguous. In this case, the 180\u00b0 rotation along g_3 g_3 leads two different crystal orientations. On the contrary, the right side of the figure is not ambiguous, as the 180\u00b0 rotation along (0\\bar{1}1) (0\\bar{1}1) is a crystal symmetry. Same ambiguities can arise when indexing zone axes that present a 180\u00b0 rotational symmetry which does not exist in the crystal. In diffraction ambiguous results can be detected.","title":"Orientation from a set of diffraction vectors"},{"location":"diffraction/#interface","text":"The interface is composed of a top bar menu, a plotting area to display diffraction pattern and a setting/results panel.","title":"Interface"},{"location":"diffraction/#procedure","text":"","title":"Procedure"},{"location":"diffraction/#defining-the-crystal-structure","text":"Crystal structure can be imported from the structure menu. This menu can be populated by adding structures in the structure.txt files following the template: Name a(A) b(A) c(A) alpha beta gamma space group The space group is defined in the space_group.txt file and with the scattering.txt file as defined above. Alternatively, the structure can be set by filling the a,b,c a,b,c and \\alpha \\alpha , \\beta \\beta , \\gamma \\gamma fields.","title":"Defining the crystal structure"},{"location":"diffraction/#workflow","text":"Open a diffraction pattern. Make sure that the file name does not contain non-ASCII character. Define a calibration in the Calibrations box Set the Diffraction alpha y-axis angle (see stereoproj ) Left click on a diffraction spot. Zoom in to ensure a higher precision. Click again on a second spot corresponding to the diffraction order n n . Indicate the order n n in the diffraction order field. Click reset view or reset point if needed The distance d d (A) and the inclination angle \\eta \\eta are indicated in the Dist, Inclination box.","title":"Workflow"},{"location":"diffraction/#option-1-computer-aided-determination-of-hkl-indices","text":"In most of case, the reflections indices can be determined unambiguously from their d-spacing. Indicate a value in px in the precision box. The g-vectors will be chosen within the uncertainty range \\pm \\pm the precision. By default, the value is 10 px. Select the d-spacing in the Dist, Inclination box. Click on Find diffraction spots to identify the spot . The results appear in the g vectors box with the scheme d(A) | h,k,l | Intensity(arb. units) | angles The angles values are explained below. The data (h,k,l) (h,k,l) , the inclination angle \\eta \\eta and the tilt angles, can be used to plot stereographic projection from a diffraction vector Thus for every diffraction patterns, the diffraction vector, inclination angle, and tilt angles need to be provided. Fill the tilt angles fields. Tick the box to indicate that rotation is anti-clockwise. Tick the 2-to-3 beams check box if a correction from a 2-beam to a 3-beam condition is required (see above ). This leads to the evaluation of the out of plane angle \\epsilon \\epsilon . Click and Find diffraction spots Select both the dist, inclination field and the appropriate g vector . For the first condition, the indices of the g-vector can arbitrary be chosen. Press Add data . A line appears alpha angle, beta angle, theta angle, inclination, h,k,l, epsilon angle . Data can be removed by selecting the line and by pressing Remove data . Repeat the above operations for at least 2 diffraction spots. For every conditions, the angle between the proposed g-vectors and the already chosen g-vectors are indicated. Choose the (h,k,l) (h,k,l) indices that minimize all the angles.","title":"Option 1: computer-aided determination of (h,k,l) indices"},{"location":"diffraction/#option-2-automatic-determination","text":"When the reflections are ambiguous from their d-spacing, consistent sets of data can be retrieved by comparing the measured angles \\theta_{ij}=\\angle{(\\vec{g}_i,\\vec{g}_j)} \\theta_{ij}=\\angle{(\\vec{g}_i,\\vec{g}_j)} with a lookup table compiling the angles \\theta'_{ij}=\\angle{((h_i,k_i,l_i),(h_j,k_j,l_j))} \\theta'_{ij}=\\angle{((h_i,k_i,l_i),(h_j,k_j,l_j))} . The sets of g-vectors are obtained if all the angles difference \\left|\\theta_{ij}-\\theta'_{ij}\\right| \\left|\\theta_{ij}-\\theta'_{ij}\\right| is less than a tolerance angle equals to 3 degrees. To proceed this way: Tick the do not use g-vector guess box. Add the spot as above. The indices will appear as 0,0,0 .","title":"Option 2: Automatic determination"},{"location":"diffraction/#retrieve-orientation","text":"Select the data lines and press Get orientation The result box shows: phi1, phi, phi2 (Euler angles) mean angular deviation, mean d-spacing deviation In case of option 2, the (hkl) (hkl) indices are indicated. Two sets of phi1, phi, phi2 angles are displayed if the results are ambiguous. The accuracy of the result is given by: The mean angular deviation , which is the average angle between each diffraction vector computed from the Euler angles and the experimental values: \\langle \\theta_d \\rangle = \\frac{1}{N}{\\sum_i^N \\left| \\arccos(R \\vec{g}_i \\cdot [x_i,y_i,z_i]^T) \\right|} \\langle \\theta_d \\rangle = \\frac{1}{N}{\\sum_i^N \\left| \\arccos(R \\vec{g}_i \\cdot [x_i,y_i,z_i]^T) \\right|} where \\vec{g}_i \\vec{g}_i is the normalized diffraction vector corresponding to the (h_i,k_i,l_i) (h_i,k_i,l_i) plane. The mean d-spacing deviation , in percents, is the mean spread between measured and expected d-spacings. It should be of typically less than 10/% \\langle d \\rangle= \\frac{1}{N}{\\sum_i^N \\left| \\frac{d_{hkl}-d_i}{d_{hkl}}\\right|} \\langle d \\rangle= \\frac{1}{N}{\\sum_i^N \\left| \\frac{d_{hkl}-d_i}{d_{hkl}}\\right|} In case of option 2, the results are sorted by ascending order of mean deviation angles and mean d-spacing.","title":"Retrieve orientation"},{"location":"diffraction/#importexport-data","text":"Using the Data menu, data can be imported and results exported. Data sets are provided in a .txt file using the following scheme # Diffraction data file alpha_1,beta_1,theta_1,eta_1,h_1,k_1,l_1,epsilon_1 ... alpha_N,beta_N,theta_N,eta_N,h_N,k_N,l_N,epsilon_N Exporting data will write in a .txt file, adding to the above datasets: # Results # Phi1,Phi,Phi2 # phi_1,phi, phi_2 # Mean angular deviation, Mean square angular dev. # ang_d, ang_d^2 The two files can be combined in one as # sign will not be read during import.","title":"Import/Export data"},{"location":"diffraction/#spectrum","text":"Spectra, i.e. peak intensity with respect to the d-spacing, can be plotted from the top menu. The maximum indices should be indicated. if the diffraction is taking away from the three-beam condition, an extra rotation R_x(\\epsilon) R_x(\\epsilon) applies, with \\epsilon = \\theta_B+s/\\|\\vec{g}\\|^2 \\epsilon = \\theta_B+s/\\|\\vec{g}\\|^2 . J. Mackenzie, Acta Cryst. 1957, 10, 61.","title":"Spectrum"},{"location":"interface/","text":"interface allows to determine interface normal or direction from a set of images. Introduction Determining an interface plane can be performed using a series of TEM images (usually in Bright Field) acquired during a tilting series. Here we show how to get a quantitative assessment of the interface normal. In TEM, a plane interface of normal \\vec{n} \\vec{n} appear as a projection in the viewing screen. For a given orientation determined by the beam direction \\vec{b}_e \\vec{b}_e in the sample reference frame (noted with the subscript S S ), the interface plane is fully described by the direction of the projected traces \\vec{t}_p \\vec{t}_p that correspond to the intersection between the foil surface \\vec{s} \\vec{s} and the plane. In the projected plane coordinates (noted with P P ), the direction of the trace can be characterized by the azimuth angle \\eta \\eta with the y_P y_P direction. Note that because of the electron optics, the projected plane frame can be rotated with respect to the holder coordinate system (noted with H H ) along z_P=z_H z_P=z_H (see this section , for the definition of the holder coordinate system). If the two surfaces are parallel the two projected traces are also parallel (fig. a). Thus, the width w w between the two traces can be also measured. These data constitute the set (\\vec{b}_e, \\eta ,w) (\\vec{b}_e, \\eta ,w) . If the surfaces are not parallel, the approach described below still works if a specific point C C (projected on H H ) can be tracked (fig. b). It can be shown that the apparent width w w is given by: w= \\frac{ \\lvert d\\vec{n} \\cdot \\vec{b}_e \\rvert}{\\sqrt{ 1- (\\vec{b}_e \\cdot \\vec{t})^2}} w= \\frac{ \\lvert d\\vec{n} \\cdot \\vec{b}_e \\rvert}{\\sqrt{ 1- (\\vec{b}_e \\cdot \\vec{t})^2}} The unit normal vector \\vec{n} \\vec{n} can be estimated following the two steps procedure: first solve \\vec{t} \\vec{t} following the m m equations: [\\vec{b}_{e1} \\times \\vec{t}_{p1}, ..., \\vec{b}_{em} \\times \\vec{t}_{pm} ]^T \\cdot \\vec{t} =0 [\\vec{b}_{e1} \\times \\vec{t}_{p1}, ..., \\vec{b}_{em} \\times \\vec{t}_{pm} ]^T \\cdot \\vec{t} =0 then solve : \\left[\\begin{array}{c} \\vec{b}_{e1}^\\mathrm{T} \\\\[2mm] \\vec{b}_{e2}^\\mathrm{T} \\\\[2mm] ...\\\\ \\vec{b}_{em}^\\mathrm{T} \\\\[2mm] \\vec{t}^\\mathrm{T} \\end{array}\\right] (d \\vec{n}) =\\left[\\begin{array}{c} \\mathrm{sgn}(1) w_1\\sqrt{1- \\left(\\vec{b}_{e1} \\cdot \\vec{t} \\right)^2}\\\\[0.5mm] \\mathrm{sgn}(2)w_2\\sqrt{1- \\left(\\vec{b}_{e2} \\cdot \\vec{t} \\right)^2}\\\\[0.5mm] ...\\\\ \\mathrm{sgn}(m)w_m\\sqrt{1- \\left(\\vec{b}_{em} \\cdot \\vec{t} \\right)^2}\\\\[0.5mm] 0 \\end{array} \\right] \\left[\\begin{array}{c} \\vec{b}_{e1}^\\mathrm{T} \\\\[2mm] \\vec{b}_{e2}^\\mathrm{T} \\\\[2mm] ...\\\\ \\vec{b}_{em}^\\mathrm{T} \\\\[2mm] \\vec{t}^\\mathrm{T} \\end{array}\\right] (d \\vec{n}) =\\left[\\begin{array}{c} \\mathrm{sgn}(1) w_1\\sqrt{1- \\left(\\vec{b}_{e1} \\cdot \\vec{t} \\right)^2}\\\\[0.5mm] \\mathrm{sgn}(2)w_2\\sqrt{1- \\left(\\vec{b}_{e2} \\cdot \\vec{t} \\right)^2}\\\\[0.5mm] ...\\\\ \\mathrm{sgn}(m)w_m\\sqrt{1- \\left(\\vec{b}_{em} \\cdot \\vec{t} \\right)^2}\\\\[0.5mm] 0 \\end{array} \\right] the \\mathrm{sgn}(i) \\mathrm{sgn}(i) here denotes that although the measure width is always positive, the dot product \\vec{b}_{ei} \\cdot \\vec{n} \\vec{b}_{ei} \\cdot \\vec{n} can be negative. The equation can be solved using the least square method, by varying \\mathrm{sgn}(i) \\mathrm{sgn}(i) . The solution with the smallest residual is considered to be the correct one. The inputs data used are for a double tilt holder using the convention described in stereoproj derived from the position of the beam direction and apparent trace direction in the sample coordinates: \\vec{b}_{ei}=R_x(-\\beta_i)R_y(-\\alpha_i)[0,0,1]^T \\\\ \\vec{t}_{pi}=R_x(-\\beta_i)R_y(-\\alpha_i)R_z(\\delta)R_z(\\eta)[0,1,0]^T \\vec{b}_{ei}=R_x(-\\beta_i)R_y(-\\alpha_i)[0,0,1]^T \\\\ \\vec{t}_{pi}=R_x(-\\beta_i)R_y(-\\alpha_i)R_z(\\delta)R_z(\\eta)[0,1,0]^T Line determination The same approach can be used to determine a linear feature \\vec{l} \\vec{l} using the data sets (\\vec{b}_{ei}, \\vec{l}_{pi}, l_i) (\\vec{b}_{ei}, \\vec{l}_{pi}, l_i) by solving: [\\vec{b}_{ei} \\times \\vec{l}_{pi}, \\vec{l}_{pi}]^T d\\vec{l} =[0, sgn(i) l_i]^T [\\vec{b}_{ei} \\times \\vec{l}_{pi}, \\vec{l}_{pi}]^T d\\vec{l} =[0, sgn(i) l_i]^T Interface The interface is composed of a top bar menu, a plotting area to display images and a setting/results panel. Procedure Settings The interface normal can be determined in the sample frame. If necessary it can be determined in the crystal frame if both the nature of crystal and its orientation are known. This requires to tick the Use lattice coordinates button. Crystal structure can be imported from the structure menu or by filling the a,b,c a,b,c and \\alpha,\\beta,\\gamma \\alpha,\\beta,\\gamma fields. Microscope calibration need to be set to get correct scaling when the apparent widths w w are measured. If the box is set to uncalibrated measured will be performed in pixels. Calibrations can be set in the microscope.txt file with the following scheme: Microscope_name Magnification nm/px delta(\u00b0) The \\delta \\delta angle is the angle between the y y axis and the \\alpha \\alpha -tilt axis. It can also be entered directly in the image-alpha tilt box. When calibrated, the Magnification field can be filled. Note that magnification entered are multiplied by 1000. Getting data Select the holder configuration Open an image taken at a given \\alpha \\alpha , \\beta \\beta , \\theta \\theta angles. Anticlockwise rotation can be indicated in the AC box. Make sure that the file name does not contain non-ASCII character. Select the corresponding magnification for a given microscope setting On the image, define the apparent trace direction by clicking on two points. Click a third point on the second trace (from a reference point if the traces are not parallel). Zoom in the image if necessary. The view and points can be reset using the two corresponding buttons Add data to the list. In the data box below appears width, eta angle, alpha, beta, theta Repeat the operation to get at least 3 conditions but 5-6 will improve accuracy. Select the lines used for the analysis Press the Get normal/direction to get the plane normal. The results appear as: Plane normal x, y, z (or h,k,l if using the lattice coordinates) Trace xt,yt,zt Error on trace direction (\u00b0) value Error on plane normal (\u00b0) value Plane width d in px or nm if calibrated Error on plane width value in px or nm Estimated thickness value +/- in px or nm Results accuracy Errors are computed using the bootstrap method . Starting from the set of data (\\vec{b}_{ei}, \\eta_i) (\\vec{b}_{ei}, \\eta_i) or (\\vec{b}_{ei}, w_i) (\\vec{b}_{ei}, w_i) , to estimate the trace direction and normal, respectively, the data sets were resampled and estimated traces and normals were determined using the equation above. The 95% confidence interval was calculated from the 92th percentile of deviation of the trace and normal. This indicates that the normal should stay in a cone centered around \\vec{n} \\vec{n} with a deviation of \\Delta\\theta=\\widehat{(\\vec{n},\\vec{n}'_{0.95})} \\Delta\\theta=\\widehat{(\\vec{n},\\vec{n}'_{0.95})} . The same procedure is carried out also in case of the measurement of direction which leads to \\Delta\\theta=\\widehat{(\\vec{l},\\vec{l}'_{0.95})} \\Delta\\theta=\\widehat{(\\vec{l},\\vec{l}'_{0.95})} . Note that for some configurations, the confidence interval may be excessively large due to spurious resampling. Adding multiple data, ie. several measurements will prevent from this effect. The sample thickness can be estimated from: t=d\\sqrt{1-(\\vec{n}\\cdot\\vec{s})^2}=d\\vec{l}\\cdot\\vec{s} t=d\\sqrt{1-(\\vec{n}\\cdot\\vec{s})^2}=d\\vec{l}\\cdot\\vec{s} \\vec{s} \\vec{s} being the foil normal. It is estimated in the results by considering that the foil normal is along z_M z_M . The error on the estimation is complex because it depends both on the error on d d and on the deviation of \\vec{n} \\vec{n} or \\vec{l} \\vec{l} . The two contributions can be approximately estimated to provide an error on the thickness. Example of interface determination from a set of images (see here ). Cones around n n and t t (normal and trace) corresponds to the 92% confidence interval. Drawing Drawing interface projection can be done using the Draw menu. Enter crystal thickness. Use the value given in the result box. Surface normal can be indicated if known by ticking the surf box. Otherwise the surface is chosen as the plane normal to beam direction at zero tilt, which is usually a good approximation. Surface normal can be determined by the method shown here if two interface traces are present. Enter the plane. Direction can be plotted if the dir. box is ticked. A label can be displayed when the label box is ticked. If the crystal is hexagonal, tick the hexa box to get the correct 4 indices for directions (the third indices is omitted) Click on one trace. Don't forget to fill the tilt angles and microscope settings. Press OK to plot the two apparent traces at the clicked point. The same procedure can be applied to determined and draw directions. The direction box should then be checked. Measuring If two points are defined on the image, if the measure box is ticked, and if a plane is indicated, a result field appears in the dialog window. It indicates: the distance measured in the plane (in nm if calibrated) the direction in the plane the maximum length in the direction, according to the sample thickness the measure projected length (in nm) If the proj. image is checked, a stretched image is displayed. It corresponds to the image in the indicated plane. It allows to make directly measurement in this image without perspective effects. A scale of a given length can be added. Import/Export data Using the Data menu, data can be imported and results exported. Data sets are provided in a .txt file using the following scheme # Interface data file # Euler angles phi1,phi, phi2 (may be left blank) # Data for a plane/direction w_1(or l_1), eta_1,alpha_1,beta_1,theta_1 ... w_N(or l_N), eta_N,alpha_N,beta_N,theta_N Exporting data will write in a .txt file, adding to the above datasets. For plane: # Results # Plane normal # n_1,n_2, n_3 # Trace # t_1,t_2,t_3 # Error on trace direction (deg) # ang # Error on plane normal (deg) # ang # Plane width # d # Error on plane width # dd # Estimated thickness # t for directions: # Results # Direction # d1,d2,d3 # Error on trace direction (deg) # ang # Direction length # l # Error on direction width # dl # Estimated thickness # t The two files can be combined in one as # sign will not be read during import.","title":"Interface"},{"location":"interface/#introduction","text":"Determining an interface plane can be performed using a series of TEM images (usually in Bright Field) acquired during a tilting series. Here we show how to get a quantitative assessment of the interface normal. In TEM, a plane interface of normal \\vec{n} \\vec{n} appear as a projection in the viewing screen. For a given orientation determined by the beam direction \\vec{b}_e \\vec{b}_e in the sample reference frame (noted with the subscript S S ), the interface plane is fully described by the direction of the projected traces \\vec{t}_p \\vec{t}_p that correspond to the intersection between the foil surface \\vec{s} \\vec{s} and the plane. In the projected plane coordinates (noted with P P ), the direction of the trace can be characterized by the azimuth angle \\eta \\eta with the y_P y_P direction. Note that because of the electron optics, the projected plane frame can be rotated with respect to the holder coordinate system (noted with H H ) along z_P=z_H z_P=z_H (see this section , for the definition of the holder coordinate system). If the two surfaces are parallel the two projected traces are also parallel (fig. a). Thus, the width w w between the two traces can be also measured. These data constitute the set (\\vec{b}_e, \\eta ,w) (\\vec{b}_e, \\eta ,w) . If the surfaces are not parallel, the approach described below still works if a specific point C C (projected on H H ) can be tracked (fig. b). It can be shown that the apparent width w w is given by: w= \\frac{ \\lvert d\\vec{n} \\cdot \\vec{b}_e \\rvert}{\\sqrt{ 1- (\\vec{b}_e \\cdot \\vec{t})^2}} w= \\frac{ \\lvert d\\vec{n} \\cdot \\vec{b}_e \\rvert}{\\sqrt{ 1- (\\vec{b}_e \\cdot \\vec{t})^2}} The unit normal vector \\vec{n} \\vec{n} can be estimated following the two steps procedure: first solve \\vec{t} \\vec{t} following the m m equations: [\\vec{b}_{e1} \\times \\vec{t}_{p1}, ..., \\vec{b}_{em} \\times \\vec{t}_{pm} ]^T \\cdot \\vec{t} =0 [\\vec{b}_{e1} \\times \\vec{t}_{p1}, ..., \\vec{b}_{em} \\times \\vec{t}_{pm} ]^T \\cdot \\vec{t} =0 then solve : \\left[\\begin{array}{c} \\vec{b}_{e1}^\\mathrm{T} \\\\[2mm] \\vec{b}_{e2}^\\mathrm{T} \\\\[2mm] ...\\\\ \\vec{b}_{em}^\\mathrm{T} \\\\[2mm] \\vec{t}^\\mathrm{T} \\end{array}\\right] (d \\vec{n}) =\\left[\\begin{array}{c} \\mathrm{sgn}(1) w_1\\sqrt{1- \\left(\\vec{b}_{e1} \\cdot \\vec{t} \\right)^2}\\\\[0.5mm] \\mathrm{sgn}(2)w_2\\sqrt{1- \\left(\\vec{b}_{e2} \\cdot \\vec{t} \\right)^2}\\\\[0.5mm] ...\\\\ \\mathrm{sgn}(m)w_m\\sqrt{1- \\left(\\vec{b}_{em} \\cdot \\vec{t} \\right)^2}\\\\[0.5mm] 0 \\end{array} \\right] \\left[\\begin{array}{c} \\vec{b}_{e1}^\\mathrm{T} \\\\[2mm] \\vec{b}_{e2}^\\mathrm{T} \\\\[2mm] ...\\\\ \\vec{b}_{em}^\\mathrm{T} \\\\[2mm] \\vec{t}^\\mathrm{T} \\end{array}\\right] (d \\vec{n}) =\\left[\\begin{array}{c} \\mathrm{sgn}(1) w_1\\sqrt{1- \\left(\\vec{b}_{e1} \\cdot \\vec{t} \\right)^2}\\\\[0.5mm] \\mathrm{sgn}(2)w_2\\sqrt{1- \\left(\\vec{b}_{e2} \\cdot \\vec{t} \\right)^2}\\\\[0.5mm] ...\\\\ \\mathrm{sgn}(m)w_m\\sqrt{1- \\left(\\vec{b}_{em} \\cdot \\vec{t} \\right)^2}\\\\[0.5mm] 0 \\end{array} \\right] the \\mathrm{sgn}(i) \\mathrm{sgn}(i) here denotes that although the measure width is always positive, the dot product \\vec{b}_{ei} \\cdot \\vec{n} \\vec{b}_{ei} \\cdot \\vec{n} can be negative. The equation can be solved using the least square method, by varying \\mathrm{sgn}(i) \\mathrm{sgn}(i) . The solution with the smallest residual is considered to be the correct one. The inputs data used are for a double tilt holder using the convention described in stereoproj derived from the position of the beam direction and apparent trace direction in the sample coordinates: \\vec{b}_{ei}=R_x(-\\beta_i)R_y(-\\alpha_i)[0,0,1]^T \\\\ \\vec{t}_{pi}=R_x(-\\beta_i)R_y(-\\alpha_i)R_z(\\delta)R_z(\\eta)[0,1,0]^T \\vec{b}_{ei}=R_x(-\\beta_i)R_y(-\\alpha_i)[0,0,1]^T \\\\ \\vec{t}_{pi}=R_x(-\\beta_i)R_y(-\\alpha_i)R_z(\\delta)R_z(\\eta)[0,1,0]^T","title":"Introduction"},{"location":"interface/#line-determination","text":"The same approach can be used to determine a linear feature \\vec{l} \\vec{l} using the data sets (\\vec{b}_{ei}, \\vec{l}_{pi}, l_i) (\\vec{b}_{ei}, \\vec{l}_{pi}, l_i) by solving: [\\vec{b}_{ei} \\times \\vec{l}_{pi}, \\vec{l}_{pi}]^T d\\vec{l} =[0, sgn(i) l_i]^T [\\vec{b}_{ei} \\times \\vec{l}_{pi}, \\vec{l}_{pi}]^T d\\vec{l} =[0, sgn(i) l_i]^T","title":"Line determination"},{"location":"interface/#interface","text":"The interface is composed of a top bar menu, a plotting area to display images and a setting/results panel.","title":"Interface"},{"location":"interface/#procedure","text":"","title":"Procedure"},{"location":"interface/#settings","text":"The interface normal can be determined in the sample frame. If necessary it can be determined in the crystal frame if both the nature of crystal and its orientation are known. This requires to tick the Use lattice coordinates button. Crystal structure can be imported from the structure menu or by filling the a,b,c a,b,c and \\alpha,\\beta,\\gamma \\alpha,\\beta,\\gamma fields. Microscope calibration need to be set to get correct scaling when the apparent widths w w are measured. If the box is set to uncalibrated measured will be performed in pixels. Calibrations can be set in the microscope.txt file with the following scheme: Microscope_name Magnification nm/px delta(\u00b0) The \\delta \\delta angle is the angle between the y y axis and the \\alpha \\alpha -tilt axis. It can also be entered directly in the image-alpha tilt box. When calibrated, the Magnification field can be filled. Note that magnification entered are multiplied by 1000.","title":"Settings"},{"location":"interface/#getting-data","text":"Select the holder configuration Open an image taken at a given \\alpha \\alpha , \\beta \\beta , \\theta \\theta angles. Anticlockwise rotation can be indicated in the AC box. Make sure that the file name does not contain non-ASCII character. Select the corresponding magnification for a given microscope setting On the image, define the apparent trace direction by clicking on two points. Click a third point on the second trace (from a reference point if the traces are not parallel). Zoom in the image if necessary. The view and points can be reset using the two corresponding buttons Add data to the list. In the data box below appears width, eta angle, alpha, beta, theta Repeat the operation to get at least 3 conditions but 5-6 will improve accuracy. Select the lines used for the analysis Press the Get normal/direction to get the plane normal. The results appear as: Plane normal x, y, z (or h,k,l if using the lattice coordinates) Trace xt,yt,zt Error on trace direction (\u00b0) value Error on plane normal (\u00b0) value Plane width d in px or nm if calibrated Error on plane width value in px or nm Estimated thickness value +/- in px or nm Results accuracy Errors are computed using the bootstrap method . Starting from the set of data (\\vec{b}_{ei}, \\eta_i) (\\vec{b}_{ei}, \\eta_i) or (\\vec{b}_{ei}, w_i) (\\vec{b}_{ei}, w_i) , to estimate the trace direction and normal, respectively, the data sets were resampled and estimated traces and normals were determined using the equation above. The 95% confidence interval was calculated from the 92th percentile of deviation of the trace and normal. This indicates that the normal should stay in a cone centered around \\vec{n} \\vec{n} with a deviation of \\Delta\\theta=\\widehat{(\\vec{n},\\vec{n}'_{0.95})} \\Delta\\theta=\\widehat{(\\vec{n},\\vec{n}'_{0.95})} . The same procedure is carried out also in case of the measurement of direction which leads to \\Delta\\theta=\\widehat{(\\vec{l},\\vec{l}'_{0.95})} \\Delta\\theta=\\widehat{(\\vec{l},\\vec{l}'_{0.95})} . Note that for some configurations, the confidence interval may be excessively large due to spurious resampling. Adding multiple data, ie. several measurements will prevent from this effect. The sample thickness can be estimated from: t=d\\sqrt{1-(\\vec{n}\\cdot\\vec{s})^2}=d\\vec{l}\\cdot\\vec{s} t=d\\sqrt{1-(\\vec{n}\\cdot\\vec{s})^2}=d\\vec{l}\\cdot\\vec{s} \\vec{s} \\vec{s} being the foil normal. It is estimated in the results by considering that the foil normal is along z_M z_M . The error on the estimation is complex because it depends both on the error on d d and on the deviation of \\vec{n} \\vec{n} or \\vec{l} \\vec{l} . The two contributions can be approximately estimated to provide an error on the thickness. Example of interface determination from a set of images (see here ). Cones around n n and t t (normal and trace) corresponds to the 92% confidence interval.","title":"Getting data"},{"location":"interface/#drawing","text":"Drawing interface projection can be done using the Draw menu. Enter crystal thickness. Use the value given in the result box. Surface normal can be indicated if known by ticking the surf box. Otherwise the surface is chosen as the plane normal to beam direction at zero tilt, which is usually a good approximation. Surface normal can be determined by the method shown here if two interface traces are present. Enter the plane. Direction can be plotted if the dir. box is ticked. A label can be displayed when the label box is ticked. If the crystal is hexagonal, tick the hexa box to get the correct 4 indices for directions (the third indices is omitted) Click on one trace. Don't forget to fill the tilt angles and microscope settings. Press OK to plot the two apparent traces at the clicked point. The same procedure can be applied to determined and draw directions. The direction box should then be checked.","title":"Drawing"},{"location":"interface/#measuring","text":"If two points are defined on the image, if the measure box is ticked, and if a plane is indicated, a result field appears in the dialog window. It indicates: the distance measured in the plane (in nm if calibrated) the direction in the plane the maximum length in the direction, according to the sample thickness the measure projected length (in nm) If the proj. image is checked, a stretched image is displayed. It corresponds to the image in the indicated plane. It allows to make directly measurement in this image without perspective effects. A scale of a given length can be added.","title":"Measuring"},{"location":"interface/#importexport-data","text":"Using the Data menu, data can be imported and results exported. Data sets are provided in a .txt file using the following scheme # Interface data file # Euler angles phi1,phi, phi2 (may be left blank) # Data for a plane/direction w_1(or l_1), eta_1,alpha_1,beta_1,theta_1 ... w_N(or l_N), eta_N,alpha_N,beta_N,theta_N Exporting data will write in a .txt file, adding to the above datasets. For plane: # Results # Plane normal # n_1,n_2, n_3 # Trace # t_1,t_2,t_3 # Error on trace direction (deg) # ang # Error on plane normal (deg) # ang # Plane width # d # Error on plane width # dd # Estimated thickness # t for directions: # Results # Direction # d1,d2,d3 # Error on trace direction (deg) # ang # Direction length # l # Error on direction width # dl # Estimated thickness # t The two files can be combined in one as # sign will not be read during import.","title":"Import/Export data"},{"location":"kikuchi/","text":"kikuchi allows to determine orientation from a kikuchi pattern. Introduction Kikuchi lines result from inelastic scattering in a sufficiently thick crystal. Considering an electron beam entering the crystal, electron are scattered in different directions, but more likely in the forward direction. The electrons that are in Bragg conditions, i.e. forming an angle \\pm \\theta_B \\pm \\theta_B , with an atomic plane will eventually be diffracted. Their wave vectors \\vec{k}_0 \\vec{k}_0 , \\vec{k}'_0 \\vec{k}'_0 are distributed in two Kossel cones of aperture 90-\\theta_B 90-\\theta_B , around the plane normal, corresponding to the diffraction vectors \\vec{g} \\vec{g} or \\vec{g}'=-\\vec{g} \\vec{g}'=-\\vec{g} . The diffrated beam with wave vectors \\vec{k}_g \\vec{k}_g and \\vec{k}'_g \\vec{k}'_g , which are also distributed on the cones, intersect the observation screen and form lines, as \\theta_B \\theta_B is small. Because the inelastic scattering is more intense in the forward direction, the diffracted beam \\vec{k}_g \\vec{k}_g gives rise to a line with a higher intensity, i.e. an excess line. On the contrary, \\vec{k}'_g \\vec{k}'_g corresponds to a defected line. The defected and excess lines are separated by the angle 2\\theta_B 2\\theta_B which in the observation plane corresponds to a distance r \\approx L\\theta_B = \\frac{\\lambda L}{d} r \\approx L\\theta_B = \\frac{\\lambda L}{d} where L L is the camera length, i.e. the effective distance between the back focal plane of the objective lens and the observation screen, \\lambda \\lambda the electron wavelength, and d d the interplanar distance related to the (h,k,l) (h,k,l) plane. Thus, the nature of the Kikuchi bands can be determined, knowing the calibration parameter L L , the electron wavelength, which depends on the acceleration voltage and the crystal structure. Indexing Kikuchi bands (h,k,l) (h,k,l) bands can be retrieved, knowing the crystal structure. It can be imported from the structure menu. This menu can be populated by adding structures in the structure.txt files following the template: Name a(A) b(A) c(A) alpha beta gamma space group The space group is defined in the space_group.txt file and with the scattering.txt file (see diffraction for more details). Alternatively, the structure can be set by filling the a,b,c a,b,c and \\alpha \\alpha , \\beta \\beta , \\gamma \\gamma fields. Calibration The Kikuchi pattern needs to be calibrated on the microscope used but the calibration can be adjusted afterward. The calibrations are set in the calibration.txt file following the scheme: Microscope_name voltage camera length binning r.d ... Orientation Orientation of the crystal can be retrieved from the analysis of the band configuration in an approach similar to the one described in diffraction . The figure below shows the relation between the Kikuchi bands that can be defined by their normal vector \\vec{v}_{i} \\vec{v}_{i} and their projection \\vec{v}_{pi} \\vec{v}_{pi} in the the observation plane normal to vector \\vec{z}_P \\vec{z}_P , i.e. the reverse of the electron beam direction. From the projected vector, the normal band vector in the viewing screen coordinate system (x,y,z)_P (x,y,z)_P can be deduced knowing the camera length L=\\|\\vec{OP}\\| L=\\|\\vec{OP}\\| : \\vec{v}_i=[x_i,y_i,z_i]^T=\\vec{v}_{pi}+[0,0,\\|\\vec{v}_{pi}\\|^2/L]^T \\vec{v}_i=[x_i,y_i,z_i]^T=\\vec{v}_{pi}+[0,0,\\|\\vec{v}_{pi}\\|^2/L]^T Considering N bands, the orientation can be defined by: G_c A=G_s G_c A=G_s with G_c=D^\\ast \\begin{pmatrix} h_1 k_1 l_1\\\\ ... \\\\ h_N k_N l_N \\end{pmatrix} G_c=D^\\ast \\begin{pmatrix} h_1 & k_1 & l_1\\\\ & ... & \\\\ h_N & k_N & l_N \\end{pmatrix} the g-vectors in the crystal coordinates and D^\\ast D^\\ast is defined here , and: G_s=\\begin{pmatrix} x_1 y_1 z_1\\\\ ... \\\\ x_N y_N z_N \\end{pmatrix} G_s=\\begin{pmatrix} x_1 & y_1 & z_1\\\\ & ... & \\\\ x_N & y_N & z_N \\end{pmatrix} As the above equation defines the crystal orientation, A A should be a rotation matrix. The closest Euler rotation matrix R R can be found with the approach proposed by Mackenzie using singular value decomposition: U,S,V^T=svd(G_c^TG_s) \\\\ R=V U^T U,S,V^T=svd(G_c^TG_s) \\\\ R=V U^T The Euler angles are retrieved from the R R matrix: \\varphi_1 = \\arctan (R_{02}, R_{12}) \\\\ \\phi = \\arccos(R_{22}) \\\\ \\varphi_2 = \\arctan (R_{20},R_{21}) \\varphi_1 = \\arctan (R_{02}, R_{12}) \\\\ \\phi = \\arccos(R_{22}) \\\\ \\varphi_2 = \\arctan (R_{20},R_{21}) In diffraction , the g-vectors in crystal coordinates are determined step by step by calculating the angles between the vectors, and letting the user to choose. Kikuchi bands usually have higher indices so that it is more difficult to guess the right indices. Here we choose to compare the relative measured angles of g-vectors \\theta_{ij}=\\angle{(\\vec{g}_i,\\vec{g}_j)} \\theta_{ij}=\\angle{(\\vec{g}_i,\\vec{g}_j)} with a lookup table compiling the angles \\theta'_{ij}=\\angle{((h_i,k_i,l_i),(h_j,k_j,l_j))} \\theta'_{ij}=\\angle{((h_i,k_i,l_i),(h_j,k_j,l_j))} . A consistent set of g-vectors is obtained if all the angles difference \\left|\\theta_{ij}-\\theta'_{ij}\\right| \\left|\\theta_{ij}-\\theta'_{ij}\\right| is less than a tolerance angle \\epsilon \\epsilon that can be chosen. Interface The interface is composed of a top bar menu, a plotting area to display Kikuchi pattern and a setting/results panel. Procedure Enter the crystal structure and space group. Select the maximum indices for band identification. Enter the microscope calibration. Open a pattern. Click on the pattern center and press Add center . Position of the center appears in the box. To highlight the bands, the brightness can be adjusted. Select a band by clicking three times. The first two points define the direction along one line. The third point should be on the second parallel line. Then, both the d-spacing and the projected g-vector can be retrieved. A better accuracy can be achieved if the direction is measured with two extreme points along the line. Zooming in the pattern can also be helpful. Press Add bands . The band number and the corresponding (projected) d-spacing dp (in px) appears in the Bands box. Bands can be removed by pressing the Remove band button. Clear the points and view (if zoomed in) with the Reset points and Reset view buttons. Repeat the operation at least twice and no more than 6 times (2 to 6 bands to identify). Choose a tolerance angle \\epsilon \\epsilon less than 3 degrees. 1 by default. Plot the bands to verify the measured bands. Press the Run button to display solutions in the Results box. If no solutions, remove the bands and try a more accurate point and click and/or increase the tolerance angle. By selecting the different sets of data and by clicking on the Show bands button, the theoretical bands are plotted in overlay. The results are shown according the scheme: g: [h1,k1,l1],....,[hN,kN,lN] Euler angles phi1, phi, phi2 dev_angle, dev_width ... The dev_angle value corresponds to the mean misorientation: \\langle \\Delta \\theta \\rangle = \\frac{1}{N}{\\sum_i^N \\left| \\arccos(R \\vec{g}_{h_i k_i l_i} \\cdot [x_i,y_i,z_i]^T) \\right |} \\langle \\Delta \\theta \\rangle = \\frac{1}{N}{\\sum_i^N \\left| \\arccos(R \\vec{g}_{h_i k_i l_i} \\cdot [x_i,y_i,z_i]^T) \\right |} The dev_width value corresponds to the mean deviation on the d spacing values (in percents). \\langle \\Delta d \\rangle= \\frac{1}{N} {\\sum_i^N \\frac{\\left|d_{h_i k_i l_i} - d_i \\right|}{d_{h_i k_i l_i}} } \\langle \\Delta d \\rangle= \\frac{1}{N} {\\sum_i^N \\frac{\\left|d_{h_i k_i l_i} - d_i \\right|}{d_{h_i k_i l_i}} } These two values should be as minimum as possible. Usually a good fit can be obtained with \\langle \\Delta \\theta \\rangle \\langle \\Delta \\theta \\rangle of the order of 0.2 degrees and \\langle \\Delta d \\rangle \\langle \\Delta d \\rangle of the order of few percents. Refining the results Refining the results can be made from the Refine menu: Manual rotations along x x , y y and z z axes can be performed to judge the qualitative agreement between the pattern and the theoretical lines. The calibration and acceleration voltage can also be adjusted. By clicking the update button, the solutions are re-calculated using the new sets of values. A better fit can be judged by inspecting how \\langle \\Delta \\theta \\rangle \\langle \\Delta \\theta \\rangle and \\langle \\Delta d \\rangle \\langle \\Delta d \\rangle are minimized. The updated Euler angles can be read at the bottom of the refine window. Tilt conditions By default the orientation determined corresponds to the situation of the holder at zero tilt the Euler angle being given in the (x,y,z)_P (x,y,z)_P coordinate system. To retrieve the Euler angle at zero tilt from a tilted sample, the \\alpha \\alpha , \\beta \\beta , \\theta \\theta tilt angles and the angle \\xi \\xi between the \\alpha \\alpha -tilt axis and the y-axis should be indicated as the Euler rotation matrix at zero tilt R_0 R_0 is deduced from the rotation matrix R_t R_t obtained by the relation: R_0=R_x(-\\beta)R_y(-\\alpha)R_z(\\xi)R_t R_0=R_x(-\\beta)R_y(-\\alpha)R_z(\\xi)R_t Fill the filed in the Tilt conditions window accessed from the Tool Press Run in the main window or Update in the Refine window to update the Euler angles.","title":"Kikuchi"},{"location":"kikuchi/#introduction","text":"Kikuchi lines result from inelastic scattering in a sufficiently thick crystal. Considering an electron beam entering the crystal, electron are scattered in different directions, but more likely in the forward direction. The electrons that are in Bragg conditions, i.e. forming an angle \\pm \\theta_B \\pm \\theta_B , with an atomic plane will eventually be diffracted. Their wave vectors \\vec{k}_0 \\vec{k}_0 , \\vec{k}'_0 \\vec{k}'_0 are distributed in two Kossel cones of aperture 90-\\theta_B 90-\\theta_B , around the plane normal, corresponding to the diffraction vectors \\vec{g} \\vec{g} or \\vec{g}'=-\\vec{g} \\vec{g}'=-\\vec{g} . The diffrated beam with wave vectors \\vec{k}_g \\vec{k}_g and \\vec{k}'_g \\vec{k}'_g , which are also distributed on the cones, intersect the observation screen and form lines, as \\theta_B \\theta_B is small. Because the inelastic scattering is more intense in the forward direction, the diffracted beam \\vec{k}_g \\vec{k}_g gives rise to a line with a higher intensity, i.e. an excess line. On the contrary, \\vec{k}'_g \\vec{k}'_g corresponds to a defected line. The defected and excess lines are separated by the angle 2\\theta_B 2\\theta_B which in the observation plane corresponds to a distance r \\approx L\\theta_B = \\frac{\\lambda L}{d} r \\approx L\\theta_B = \\frac{\\lambda L}{d} where L L is the camera length, i.e. the effective distance between the back focal plane of the objective lens and the observation screen, \\lambda \\lambda the electron wavelength, and d d the interplanar distance related to the (h,k,l) (h,k,l) plane. Thus, the nature of the Kikuchi bands can be determined, knowing the calibration parameter L L , the electron wavelength, which depends on the acceleration voltage and the crystal structure.","title":"Introduction"},{"location":"kikuchi/#indexing-kikuchi-bands","text":"(h,k,l) (h,k,l) bands can be retrieved, knowing the crystal structure. It can be imported from the structure menu. This menu can be populated by adding structures in the structure.txt files following the template: Name a(A) b(A) c(A) alpha beta gamma space group The space group is defined in the space_group.txt file and with the scattering.txt file (see diffraction for more details). Alternatively, the structure can be set by filling the a,b,c a,b,c and \\alpha \\alpha , \\beta \\beta , \\gamma \\gamma fields.","title":"Indexing Kikuchi bands"},{"location":"kikuchi/#calibration","text":"The Kikuchi pattern needs to be calibrated on the microscope used but the calibration can be adjusted afterward. The calibrations are set in the calibration.txt file following the scheme: Microscope_name voltage camera length binning r.d ...","title":"Calibration"},{"location":"kikuchi/#orientation","text":"Orientation of the crystal can be retrieved from the analysis of the band configuration in an approach similar to the one described in diffraction . The figure below shows the relation between the Kikuchi bands that can be defined by their normal vector \\vec{v}_{i} \\vec{v}_{i} and their projection \\vec{v}_{pi} \\vec{v}_{pi} in the the observation plane normal to vector \\vec{z}_P \\vec{z}_P , i.e. the reverse of the electron beam direction. From the projected vector, the normal band vector in the viewing screen coordinate system (x,y,z)_P (x,y,z)_P can be deduced knowing the camera length L=\\|\\vec{OP}\\| L=\\|\\vec{OP}\\| : \\vec{v}_i=[x_i,y_i,z_i]^T=\\vec{v}_{pi}+[0,0,\\|\\vec{v}_{pi}\\|^2/L]^T \\vec{v}_i=[x_i,y_i,z_i]^T=\\vec{v}_{pi}+[0,0,\\|\\vec{v}_{pi}\\|^2/L]^T Considering N bands, the orientation can be defined by: G_c A=G_s G_c A=G_s with G_c=D^\\ast \\begin{pmatrix} h_1 k_1 l_1\\\\ ... \\\\ h_N k_N l_N \\end{pmatrix} G_c=D^\\ast \\begin{pmatrix} h_1 & k_1 & l_1\\\\ & ... & \\\\ h_N & k_N & l_N \\end{pmatrix} the g-vectors in the crystal coordinates and D^\\ast D^\\ast is defined here , and: G_s=\\begin{pmatrix} x_1 y_1 z_1\\\\ ... \\\\ x_N y_N z_N \\end{pmatrix} G_s=\\begin{pmatrix} x_1 & y_1 & z_1\\\\ & ... & \\\\ x_N & y_N & z_N \\end{pmatrix} As the above equation defines the crystal orientation, A A should be a rotation matrix. The closest Euler rotation matrix R R can be found with the approach proposed by Mackenzie using singular value decomposition: U,S,V^T=svd(G_c^TG_s) \\\\ R=V U^T U,S,V^T=svd(G_c^TG_s) \\\\ R=V U^T The Euler angles are retrieved from the R R matrix: \\varphi_1 = \\arctan (R_{02}, R_{12}) \\\\ \\phi = \\arccos(R_{22}) \\\\ \\varphi_2 = \\arctan (R_{20},R_{21}) \\varphi_1 = \\arctan (R_{02}, R_{12}) \\\\ \\phi = \\arccos(R_{22}) \\\\ \\varphi_2 = \\arctan (R_{20},R_{21}) In diffraction , the g-vectors in crystal coordinates are determined step by step by calculating the angles between the vectors, and letting the user to choose. Kikuchi bands usually have higher indices so that it is more difficult to guess the right indices. Here we choose to compare the relative measured angles of g-vectors \\theta_{ij}=\\angle{(\\vec{g}_i,\\vec{g}_j)} \\theta_{ij}=\\angle{(\\vec{g}_i,\\vec{g}_j)} with a lookup table compiling the angles \\theta'_{ij}=\\angle{((h_i,k_i,l_i),(h_j,k_j,l_j))} \\theta'_{ij}=\\angle{((h_i,k_i,l_i),(h_j,k_j,l_j))} . A consistent set of g-vectors is obtained if all the angles difference \\left|\\theta_{ij}-\\theta'_{ij}\\right| \\left|\\theta_{ij}-\\theta'_{ij}\\right| is less than a tolerance angle \\epsilon \\epsilon that can be chosen.","title":"Orientation"},{"location":"kikuchi/#interface","text":"The interface is composed of a top bar menu, a plotting area to display Kikuchi pattern and a setting/results panel.","title":"Interface"},{"location":"kikuchi/#procedure","text":"Enter the crystal structure and space group. Select the maximum indices for band identification. Enter the microscope calibration. Open a pattern. Click on the pattern center and press Add center . Position of the center appears in the box. To highlight the bands, the brightness can be adjusted. Select a band by clicking three times. The first two points define the direction along one line. The third point should be on the second parallel line. Then, both the d-spacing and the projected g-vector can be retrieved. A better accuracy can be achieved if the direction is measured with two extreme points along the line. Zooming in the pattern can also be helpful. Press Add bands . The band number and the corresponding (projected) d-spacing dp (in px) appears in the Bands box. Bands can be removed by pressing the Remove band button. Clear the points and view (if zoomed in) with the Reset points and Reset view buttons. Repeat the operation at least twice and no more than 6 times (2 to 6 bands to identify). Choose a tolerance angle \\epsilon \\epsilon less than 3 degrees. 1 by default. Plot the bands to verify the measured bands. Press the Run button to display solutions in the Results box. If no solutions, remove the bands and try a more accurate point and click and/or increase the tolerance angle. By selecting the different sets of data and by clicking on the Show bands button, the theoretical bands are plotted in overlay. The results are shown according the scheme: g: [h1,k1,l1],....,[hN,kN,lN] Euler angles phi1, phi, phi2 dev_angle, dev_width ... The dev_angle value corresponds to the mean misorientation: \\langle \\Delta \\theta \\rangle = \\frac{1}{N}{\\sum_i^N \\left| \\arccos(R \\vec{g}_{h_i k_i l_i} \\cdot [x_i,y_i,z_i]^T) \\right |} \\langle \\Delta \\theta \\rangle = \\frac{1}{N}{\\sum_i^N \\left| \\arccos(R \\vec{g}_{h_i k_i l_i} \\cdot [x_i,y_i,z_i]^T) \\right |} The dev_width value corresponds to the mean deviation on the d spacing values (in percents). \\langle \\Delta d \\rangle= \\frac{1}{N} {\\sum_i^N \\frac{\\left|d_{h_i k_i l_i} - d_i \\right|}{d_{h_i k_i l_i}} } \\langle \\Delta d \\rangle= \\frac{1}{N} {\\sum_i^N \\frac{\\left|d_{h_i k_i l_i} - d_i \\right|}{d_{h_i k_i l_i}} } These two values should be as minimum as possible. Usually a good fit can be obtained with \\langle \\Delta \\theta \\rangle \\langle \\Delta \\theta \\rangle of the order of 0.2 degrees and \\langle \\Delta d \\rangle \\langle \\Delta d \\rangle of the order of few percents.","title":"Procedure"},{"location":"kikuchi/#refining-the-results","text":"Refining the results can be made from the Refine menu: Manual rotations along x x , y y and z z axes can be performed to judge the qualitative agreement between the pattern and the theoretical lines. The calibration and acceleration voltage can also be adjusted. By clicking the update button, the solutions are re-calculated using the new sets of values. A better fit can be judged by inspecting how \\langle \\Delta \\theta \\rangle \\langle \\Delta \\theta \\rangle and \\langle \\Delta d \\rangle \\langle \\Delta d \\rangle are minimized. The updated Euler angles can be read at the bottom of the refine window.","title":"Refining the results"},{"location":"kikuchi/#tilt-conditions","text":"By default the orientation determined corresponds to the situation of the holder at zero tilt the Euler angle being given in the (x,y,z)_P (x,y,z)_P coordinate system. To retrieve the Euler angle at zero tilt from a tilted sample, the \\alpha \\alpha , \\beta \\beta , \\theta \\theta tilt angles and the angle \\xi \\xi between the \\alpha \\alpha -tilt axis and the y-axis should be indicated as the Euler rotation matrix at zero tilt R_0 R_0 is deduced from the rotation matrix R_t R_t obtained by the relation: R_0=R_x(-\\beta)R_y(-\\alpha)R_z(\\xi)R_t R_0=R_x(-\\beta)R_y(-\\alpha)R_z(\\xi)R_t Fill the filed in the Tilt conditions window accessed from the Tool Press Run in the main window or Update in the Refine window to update the Euler angles.","title":"Tilt conditions"},{"location":"misorientation/","text":"misorientation allows to determine orientation relationship and misorientation between two crystals It allows: Display two crystals at the same time on a stereographic projection which allows the easy determination of orientation relationship Orient two crystals independently Determine misorientation between two grains (same crystals) Misorientation When two crystals are separated by a grain boundary, the neighboring crystals may exhibit a specific orientation relationship that can be defined by an interface and a couple rotation axis, i.e. a common crystal direction, misorientation angle. Considering the orientation of grains A A and B B defined by their Euler angles. Their orientation in the reference frame is defined by the orientation matrix O_1 O_1 and O_2 O_2 . The misorientation matrix is given by: M=O_1 O_2^{-1} M=O_1 O_2^{-1} As M M is a rotation matrix, one could extract the couple angle-axis, (\\theta,\\vec{u}) (\\theta,\\vec{u}) according to: \\theta=\\arccos \\left(\\frac{tr(M)-1}{2}\\right) \\theta=\\arccos \\left(\\frac{tr(M)-1}{2}\\right) and M\\vec{u}=\\vec{u} M\\vec{u}=\\vec{u} However, because of crystal symmetry, the misorientation between two grains is not unique, i.e. equivalent (\\vec{u},\\theta) (\\vec{u},\\theta) exist. The misorientation axis should then be modified by: M=O_1O_SO_2^{-1} M=O_1O_SO_2^{-1} where O_S O_S are the symmetry operations of the crystal. For cubic, it consists of: Rotations along \\langle 100 \\rangle \\langle 100 \\rangle of 90\u00b0, 180\u00b0 and 270\u00b0 (9 rotations) Rotations along \\langle 110 \\rangle \\langle 110 \\rangle of 180\u00b0 (6 rotations) Rotations along \\langle 111 \\rangle \\langle 111 \\rangle of 120\u00b0 and 240\u00b0 (8 rotations) Identity operation Thus 24 symmetry operations can be applied, leading to 24 (\\vec{u},\\theta) (\\vec{u},\\theta) couples. Equivalent considerations can be made for other crystal systems. Interface The interface is composed of 3 tabs. the settings tab is used to enter the 2 crystal inputs, the microscopic settings regarding rotation between tilt axis and image, and the layout. Refer to stereoproj for the details information. the stereo-proj tab is the plotting area misorientation tab display the misorientation between crystal (if identical crystal are selected) Procedure Plotting Set the crystal parameter and layout in the setting tab. Refer to stereoproj for the details. Enter the crystal 1 and 2 orientation in the Euler Angles fields Plot the stereographic projections using the Plot button Overlay of an aluminium and an zirconium crystal. Same additional features as in stereoproj are available: adding poles/directions, planes... and can be performed independently on crystal 1 or 2 by using the Switch button Rotations can be performed along x,y,z x,y,z or along a pole/direction ( g g ) entered in the Pole/direction field, either in crystal 1 or 2 Misorientation For 2 crystals of the same structure, the misorientation can be computed after plotting the stereographic projection. In the misorientation tab: press the Find misorientation Plot Angle/Axis button the rotation axes in both crystal are displayed along with the rotation angle if the uvw button is ticked in the setting tab, the axes will be given as directions and not plane normals. in the stereographic tab, the axes appear as black dots. ticking the show numbers or show axes will display the number corresponding to the angle/axis couples and the axis indices in crystal 1 on the stereographic projection, respectively.","title":"Misorientation"},{"location":"misorientation/#misorientation","text":"When two crystals are separated by a grain boundary, the neighboring crystals may exhibit a specific orientation relationship that can be defined by an interface and a couple rotation axis, i.e. a common crystal direction, misorientation angle. Considering the orientation of grains A A and B B defined by their Euler angles. Their orientation in the reference frame is defined by the orientation matrix O_1 O_1 and O_2 O_2 . The misorientation matrix is given by: M=O_1 O_2^{-1} M=O_1 O_2^{-1} As M M is a rotation matrix, one could extract the couple angle-axis, (\\theta,\\vec{u}) (\\theta,\\vec{u}) according to: \\theta=\\arccos \\left(\\frac{tr(M)-1}{2}\\right) \\theta=\\arccos \\left(\\frac{tr(M)-1}{2}\\right) and M\\vec{u}=\\vec{u} M\\vec{u}=\\vec{u} However, because of crystal symmetry, the misorientation between two grains is not unique, i.e. equivalent (\\vec{u},\\theta) (\\vec{u},\\theta) exist. The misorientation axis should then be modified by: M=O_1O_SO_2^{-1} M=O_1O_SO_2^{-1} where O_S O_S are the symmetry operations of the crystal. For cubic, it consists of: Rotations along \\langle 100 \\rangle \\langle 100 \\rangle of 90\u00b0, 180\u00b0 and 270\u00b0 (9 rotations) Rotations along \\langle 110 \\rangle \\langle 110 \\rangle of 180\u00b0 (6 rotations) Rotations along \\langle 111 \\rangle \\langle 111 \\rangle of 120\u00b0 and 240\u00b0 (8 rotations) Identity operation Thus 24 symmetry operations can be applied, leading to 24 (\\vec{u},\\theta) (\\vec{u},\\theta) couples. Equivalent considerations can be made for other crystal systems.","title":"Misorientation"},{"location":"misorientation/#interface","text":"The interface is composed of 3 tabs. the settings tab is used to enter the 2 crystal inputs, the microscopic settings regarding rotation between tilt axis and image, and the layout. Refer to stereoproj for the details information. the stereo-proj tab is the plotting area misorientation tab display the misorientation between crystal (if identical crystal are selected)","title":"Interface"},{"location":"misorientation/#procedure","text":"","title":"Procedure"},{"location":"misorientation/#plotting","text":"Set the crystal parameter and layout in the setting tab. Refer to stereoproj for the details. Enter the crystal 1 and 2 orientation in the Euler Angles fields Plot the stereographic projections using the Plot button Overlay of an aluminium and an zirconium crystal. Same additional features as in stereoproj are available: adding poles/directions, planes... and can be performed independently on crystal 1 or 2 by using the Switch button Rotations can be performed along x,y,z x,y,z or along a pole/direction ( g g ) entered in the Pole/direction field, either in crystal 1 or 2","title":"Plotting"},{"location":"misorientation/#misorientation_1","text":"For 2 crystals of the same structure, the misorientation can be computed after plotting the stereographic projection. In the misorientation tab: press the Find misorientation Plot Angle/Axis button the rotation axes in both crystal are displayed along with the rotation angle if the uvw button is ticked in the setting tab, the axes will be given as directions and not plane normals. in the stereographic tab, the axes appear as black dots. ticking the show numbers or show axes will display the number corresponding to the angle/axis couples and the axis indices in crystal 1 on the stereographic projection, respectively.","title":"Misorientation"},{"location":"ressources/","text":"Running tests Images and diffraction patterns are available here . Information are given in the test.txt file. Kikuchi pattern, diffraction patterns and a series of bright field images can be used to test kikuchi , diffraction and interface . References General Transmission Electron Microscopy, by D. Williams and C.B. Carter link Transmission Electron Microscopy, by L. Reimer link Defect analysis in Electron Microscopy, by M. H. Loretto and I. Smallmann Practical Electron Microscopy in Materials Science, by J.W. Edington","title":"Further ressources"},{"location":"ressources/#running-tests","text":"Images and diffraction patterns are available here . Information are given in the test.txt file. Kikuchi pattern, diffraction patterns and a series of bright field images can be used to test kikuchi , diffraction and interface .","title":"Running tests"},{"location":"ressources/#references","text":"","title":"References"},{"location":"ressources/#general","text":"Transmission Electron Microscopy, by D. Williams and C.B. Carter link Transmission Electron Microscopy, by L. Reimer link Defect analysis in Electron Microscopy, by M. H. Loretto and I. Smallmann Practical Electron Microscopy in Materials Science, by J.W. Edington","title":"General"},{"location":"started/","text":"Executables Latest windows executables can be downloaded here Unpack the folder and launch the .exe files for the different tools stereoproj , diffraction , kikuchi , misorientation , interface and crystal . From python Note Consider that it is often recommended to install packages in a virtual environnement to avoid breaking dependancies for other scripts. Please refer to the document to use pipx/poetry/venv/pyenv. Prerequisites pycotem relies on python3 since versions 2.x.x, with numpy =1.19.0 , pillow =7.2.0 , matplotlib =3.3.0 . Dependancies can be installed with pip . GUI relies on pyqt5 . Earlier 1.x.x versions relies on python 2.7 with numpy =1.13.3 , pillow =5.3.0 , matplotlib =2.1.1 and pyqt4 Installing and running On windows Install python 3 from python.org Install pycotem and dependancies pip install pycotem pip install matplotlib pip install pyqt5 Run the packages with python -m pycotem.xxxx where xxxx is one of the tool stereoproj , diffraction , kikuchi , misorientation , interface and crystal . On Ubuntu Install pip3 sudo apt-get install python3-pip Install pycotem and dependancies pip3 install pycotem pip3 install matplotlib Install pyqt5 : sudo apt-get install python-qt5 Run the script with python3 -m pycotem.xxx On MacOS X Install Python from python.org or from Homebrew brew install python3 Install pycotem, matplotlib and pyqt5 with pip3 as above. pip3 install pycotem pip3 install matplotlib pip3 install pyqt5 Run the script as above Updating Use pip3 install --upgrade pycotem Examples Image files and setting parameters for testing diffraction , interface and kikuchi can be found here","title":"Getting started"},{"location":"started/#executables","text":"Latest windows executables can be downloaded here Unpack the folder and launch the .exe files for the different tools stereoproj , diffraction , kikuchi , misorientation , interface and crystal .","title":"Executables"},{"location":"started/#from-python","text":"Note Consider that it is often recommended to install packages in a virtual environnement to avoid breaking dependancies for other scripts. Please refer to the document to use pipx/poetry/venv/pyenv.","title":"From python"},{"location":"started/#prerequisites","text":"pycotem relies on python3 since versions 2.x.x, with numpy =1.19.0 , pillow =7.2.0 , matplotlib =3.3.0 . Dependancies can be installed with pip . GUI relies on pyqt5 . Earlier 1.x.x versions relies on python 2.7 with numpy =1.13.3 , pillow =5.3.0 , matplotlib =2.1.1 and pyqt4","title":"Prerequisites"},{"location":"started/#installing-and-running","text":"","title":"Installing and running"},{"location":"started/#on-windows","text":"Install python 3 from python.org Install pycotem and dependancies pip install pycotem pip install matplotlib pip install pyqt5 Run the packages with python -m pycotem.xxxx where xxxx is one of the tool stereoproj , diffraction , kikuchi , misorientation , interface and crystal .","title":"On windows"},{"location":"started/#on-ubuntu","text":"Install pip3 sudo apt-get install python3-pip Install pycotem and dependancies pip3 install pycotem pip3 install matplotlib Install pyqt5 : sudo apt-get install python-qt5 Run the script with python3 -m pycotem.xxx","title":"On Ubuntu"},{"location":"started/#on-macos-x","text":"Install Python from python.org or from Homebrew brew install python3 Install pycotem, matplotlib and pyqt5 with pip3 as above. pip3 install pycotem pip3 install matplotlib pip3 install pyqt5 Run the script as above","title":"On MacOS X"},{"location":"started/#updating","text":"Use pip3 install --upgrade pycotem","title":"Updating"},{"location":"started/#examples","text":"Image files and setting parameters for testing diffraction , interface and kikuchi can be found here","title":"Examples"},{"location":"stereoproj/","text":"stereoproj allows to work with stereographic projections. Stereographic projections A stereographic projection is a type of projection that maps a unit sphere onto a plane. It is a conformal projection, which means it preserves the angles. Stereographic projections are often use for practical reason in crystallography to display symmetry elements. This is an essential tool for electron microscopists who want to analyze microstructures. Traditionally projections are drawn by hand with the help of a Wulff net. Construction Let consider the south pole S S of a sphere lying in a (x,y,z) (x,y,z) coordinate system. A point M M in the upper hemisphere of the sphere can be projected on M' M' defined as the intersection between the line MS MS and the equatorial plane, i.e the plane that cuts the sphere at z=0 z=0 . Projection convention From a geometrical construction, points in the lower hemisphere ( z z negative) do not appear. They can alternatively be projected on the plane from the north pole instead. Opposite 3D directions, will then have opposite coordinates in the projection planes. In stereoproj we choose to discard points from the lower hemisphere. From this construction, it results several important features: 3D directions (x_0,y_0,z_0) (x_0,y_0,z_0) are projected into points of coordinates (X_0,Y_0) (X_0,Y_0) such as X_0= \\frac{x_0}{1+z_0} \\ Y_0=\\frac{y_0}{1+z_0} X_0= \\frac{x_0}{1+z_0} \\ Y_0=\\frac{y_0}{1+z_0} circles on the sphere, which correspond to 3D planes (full circles) or cones (smaller circles), are projected as portion or full circles. the north pole is located at the center of the stereographic projection the equatorial plane is projected as a great circle that bounds the stereograpic projection. any 3D direction can be defined by two angles 1 that we can choose as their inclination angle \\eta \\eta with respect to the Oy Oy direction and tilt angle \\alpha \\alpha with respect to the reference equatorial plane. The Wulff net The Wulff net results from the projection of equally distributed planes called meridians and parallels 2 . The first ones correspond to planes of a given tilt angle, the second corresponds to planes of a given inclination angle 3 . In stereoproj , meridians and parallels can be displayed and are spaced every 2\u00b0 with thicker lines every 10\u00b0. Meridians and parallels forming a Wulff net. Definition of the inclination and tilt angles Euler angles The orientation of a crystal can be set by 3 angles. Indeed given a direction, defined by two angles, the orientation can be fixed after rotating along this direction. A second standard definition of orientation is set by the Euler angles (\\varphi_1, \\phi, \\varphi_2) (\\varphi_1, \\phi, \\varphi_2) . In crystallography, it is traditionally adopted, according to Bunge, that it corresponds to: a rotation along the z z of axis \\varphi_1 \\varphi_1 a rotation along x' x' of \\phi \\phi a rotation along z' z' of \\varphi_2 \\varphi_2 . In the example below: (\\varphi_1,\\phi,\\varphi_2)=(-80,40,30) (\\varphi_1,\\phi,\\varphi_2)=(-80,40,30) Definition of the Euler angles, represented on the stereographic projection and in 3D. Points on the projections indicate the x,y,z x,y,z directions. Rotation matrices and Euler angles The orientation is defined by a rotation matrix that links the reference frame (x,y,z) (x,y,z) to the crystal frame (x',y',z') (x',y',z') by composing the 3 rotations. In the example shown, it was considered that the rotations operate sequentially in a moving frame: they are called intrinsic. This definition is however not convenient for working with rotation matrices as the rotation axes move in the reference frame. So, we can define the Euler angles from extrinsic rotations, i.e. rotations that operate in the fixed reference frame (x,y,z) (x,y,z) , in the way presented in the figure below for (\\varphi_1,\\phi,\\varphi_2)=(-80,40,30) (\\varphi_1,\\phi,\\varphi_2)=(-80,40,30) . This corresponds to: a rotation along z z of an angle \\varphi_2 \\varphi_2 , a rotation along x x of \\phi \\phi and a rotation along z z of \\varphi_1 \\varphi_1 , i.e. 4 : $$ R=R_z(\\varphi_1)R_x(\\phi)R_z(\\varphi_2) $$ where R_z(a) R_z(a) and R_x(a) R_x(a) are the rotation matrices along x x and z z axis of an angle a a . Inversely, knowing the rotation matrix, the Euler angles can be determined: $$ \\varphi_1 = \\arctan(R_{02}/R_{12}), \\phi = \\arccos(R_{22}), \\varphi_2 = \\arctan(R_{20}/R_{21}) $$ However, when \\phi=0 (\\pi) \\phi=0 (\\pi) , the angles \\varphi_2 \\varphi_2 and \\varphi_1 \\varphi_1 are not defined independently, i.e. because they share a common rotation axis. This phenomena is known as gimbal lock and can be resolved by setting \\phi = 0 \\phi = 0 , \\varphi_1 = 0 \\varphi_1 = 0 and \\varphi_2 = \\arctan(R_{10}/R_{00}) \\varphi_2 = \\arctan(R_{10}/R_{00}) Coordinate systems Coordinate system of the sample is given by the axes (x,y,z) (x,y,z) as shown in the figure below. The y y axis corresponds to the primary tilt axis called \\alpha \\alpha -tilt axis. The x x direction corresponds to the secondary tilt axis called \\beta \\beta -tilt axis for a double tilt sample holder. The z z direction is anti-parallel with the electron beam. It corresponds to the rotation axis for a tilt-rotation sample holder. By default, the rotation angles are taken positive in the clockwise sense, i.e. right handed. The sample, and then the crystal, can be rotated around the tilt axes. Rotation steps are 5\u00b0 by default. The value of rotation angle are indicated. The sense of rotation can be changed by ticking the AC (anti-clockwise) box. The Reset button allows to reset the values displayed. When the Lock Axes box is checked, the x x and z z axes are now fixed with the sample, in order to mimic the behavior of double tilt and tilt-rotation holder. Rotation in double tilt When the axes are fixed in the microscope frame (x,y,z) (x,y,z) , the rotation order matters. However when the x x axis is fixed in the sample frame and y y fixed in the microscope frame, the two operations are commutative. In terms of rotation matrices, we have: R_y(\\alpha)R_x(\\beta)=R_u(\\beta)R_y(\\alpha) \\\\ u=R_y(\\alpha) [1,0,0]~^T R_y(\\alpha)R_x(\\beta)=R_u(\\beta)R_y(\\alpha) \\\\ u=R_y(\\alpha) [1,0,0]~^T Same conclusions hold for tilt-rotation holder. Top: rotation with fixed rotation axes, Bottom: rotation with a fixed y y tilt and moving x x tilt. Red and blue paths represent a switch in the tilt order. Crystallographic feature analyses are carried out in a TEM using both diffraction and image mode. When the electrons passing through the specimen are focused in the back focal plane of the objective lens, they form a diffraction pattern which can be magnified in the projection plane where the pattern is recorded. Conversely, an image is formed in the first image plane of the objective lens, which can also be magnified in the projected lens. To switch from image to diffraction mode, the power of the objective lens has to be modified which induces an image rotation. To enlarge the pattern or the image, the effect of intermediate and projection lenses may also introduce rotations. For this reason, the holder coordinate system does not correspond to the coordinate system as viewed in the recorded image or diffraction patterns. Users need thus to determine the relation between the two. In image mode, the position of the \\alpha \\alpha -tilt axis with respect to the Y Y axis, represented by an angle \\delta \\delta , can be determined by pushing or pulling on the holder and recording the motion of features on the image. In diffraction mode, the position of the \\alpha \\alpha -tilt axis with respect to the Y Y axis, represented by an angle \\xi \\xi , can be determined by rotating the crystal and recording the displacement of the Kikuchi bands, which will be perpendicular to the rotation axis. 180\u00b0 rotation Because images and diffraction patterns are naturally inverted because of the objective lens, there usually exists a 180\u00b0 rotation between image and diffraction modes. In some cases, this extra rotation needs to be taken into account, i.e. when we care about (h,k,l) (h,k,l) or (\\bar{h},\\bar{k},\\bar{l}) (\\bar{h},\\bar{k},\\bar{l}) . This can be solved by inspecting the sense of displacement of the Kikuchi lines with respect to the tilt angle, or by inspecting how the image is inverted or not in diffraction mode, compared to image mode, when under or over-focusing the diffraction lens. Because it is easier to navigate in the stereographic projection when knowing either the angle \\delta \\delta , in reciprocal space or \\xi \\xi in direct space, the rotation angle in image and diffraction mode can be indicated in the diff alpha/y-angle and image alpha/y angle fields. Tick the img/diff box to switch to image mode. When the view is updated, the tilting axes (and Wulff net) are rotated accordingly along the z z axis as illustrated in the picture below. Note Note that the Euler angles are always defined in the (x,y,z) (x,y,z) holder coordinates. However, rotation along the \\alpha \\alpha , \\beta \\beta and \\theta \\theta axes will now be updated. Interface The interface is composed of a top menu bar, the plotting area and the plotting panel. Zoom and pan are available in the plotting area. Click on the update/reset view button to restore the full view. Plotting procedure Setting up the crystal Stereographic projection reflects the symmetry of a given lattice system which depends on the lattice parameters a,b,c a,b,c and the angles \\alpha \\alpha , \\beta \\beta and \\gamma \\gamma of the cell. a,b,c a,b,c and \\alpha, \\beta, \\gamma \\alpha, \\beta, \\gamma can be set up in the Crystal parameters . Info A crystal direction expressed by their Miller indices are related to Cartesian coordinates, in the crystal frame, by: \\begin{bmatrix}x\\\\ y \\\\ z \\end{bmatrix}=D \\begin{bmatrix}u \\\\ v \\\\ w \\end{bmatrix} \\begin{bmatrix}x\\\\ y \\\\ z \\end{bmatrix}=D \\begin{bmatrix}u \\\\ v \\\\ w \\end{bmatrix} with D= \\begin{pmatrix} a b \\cos \\gamma c \\cos \\beta \\\\ 0 b \\sin \\gamma c (\\cos \\alpha - \\cos \\beta \\cos \\gamma)/ \\sin \\gamma\\\\ 0 0 V/(a b \\sin \\gamma) \\end{pmatrix} D= \\begin{pmatrix} a & b \\cos \\gamma & c \\cos \\beta \\\\ 0 & b \\sin \\gamma & c (\\cos \\alpha - \\cos \\beta \\cos \\gamma)/ \\sin \\gamma\\\\ 0 & 0 & V/(a b \\sin \\gamma) \\end{pmatrix} V V being the crystal volume V = a b c \\sqrt {1 - \\cos^2\\alpha - \\cos^2 \\beta - \\cos^2 \\gamma + 2 \\cos \\alpha \\cos \\beta \\cos \\gamma } V = a b c \\sqrt {1 - \\cos^2\\alpha - \\cos^2 \\beta - \\cos^2 \\gamma + 2 \\cos \\alpha \\cos \\beta \\cos \\gamma } Inversely in the reciprocal space, poles, i.e. normal to planes are related by: \\begin{pmatrix}x\\\\ y \\\\ z \\end{pmatrix}=D^\\ast \\begin{pmatrix}h \\\\ k \\\\ l \\end{pmatrix} \\begin{pmatrix}x\\\\ y \\\\ z \\end{pmatrix}=D^\\ast \\begin{pmatrix}h \\\\ k \\\\ l \\end{pmatrix} with D^\\ast= (D^{-1}) ~^T D^\\ast= (D^{-1}) ~^T . The metric of the crystal G G allows to measure distance in direct and reciprocal space. The inter-reticular spacing for a plane (h,k,l) (h,k,l) for instance is given by: d_{hkl}=\\frac{1}{d^\\ast_{hkl}}=\\frac{1}{\\sqrt{(h \\ k \\ l)G^\\star (h \\ k \\ l)~^T}} d_{hkl}=\\frac{1}{d^\\ast_{hkl}}=\\frac{1}{\\sqrt{(h \\ k \\ l)G^\\star (h \\ k \\ l)~^T}} with G^\\ast=D^\\ast~^T D^\\ast G^\\ast=D^\\ast~^T D^\\ast Change the number of pole/direction drawn by increasing or decreasing the value of d and/or by changing the maximum indices . Crystal structure can be imported from the structure menu. This menu can be populated by adding structures in the structure.txt files following the template: Name a(A) b(A) c(A) alpha beta gamma space group The space group is defined in the space_group.txt file following the scheme: Name Atom name1 x1 y1 z1 Atom name1 x2 y2 z2 ... Atom name2 x3 y3 z3 Additionally, atoms need to be defined in the scattering.txt file (see diffraction for more details). From diffraction, crystals with different space groups (even with the same lattice system) present diffraction vectors, i.e. in the reciprocal space, with different intensities. Filling the space group field and ticking the reciprocal indices box will allow to plot poles with sizes proportional to their intensity (see the diffraction page for more details). Example for a TiAl crystal From Euler angles Stereographic projections can be drawn from the 3 Euler angles. The angles can be read at all time after rotation operations. Tilt and inclination angles can be read from the mouse position on the Wulff net. From a diffraction vector The orientation can be alternatively set the following way: choose a diffraction vector (h,k,l) (h,k,l) (see diffraction to determine it) set its inclination \\eta \\eta and tilt angles \\alpha \\alpha , \\beta \\beta , \\theta \\theta (comma separated) adjust a second diffraction vector by rotating around the first vector Multiple tilting axes When considering a diffraction vector obtained after double tilt ( \\alpha \\alpha and \\beta \\beta ) or after tilt-rotation ( \\alpha \\alpha , \\theta \\theta ), the diffraction vector should be placed on the stereographic projection taking into account the fact that the \\beta \\beta (or \\theta \\theta ) -tilt axis moves with the holder while \\alpha \\alpha -tilt is fixed. For instance, if the (1,1,1) (1,1,1) diffraction vector is recorded at (\\alpha,\\beta,\\theta)=(10,-20,0) (\\alpha,\\beta,\\theta)=(10,-20,0) with an inclination of \\eta=40 \\eta=40 , the diffraction is placed such that after rotating first by \\beta=-20 \\beta=-20 and second by \\alpha=10 \\alpha=10 it forms an angle \\eta=40 \\eta=40 with the y y direction on the diffraction pattern (owing that there is no rotation between the \\alpha \\alpha tilt axis and the y y direction). This means that in the sample frame, the diffraction vector coordinates are, starting from [0,1,0] [0,1,0] , in the direction [x,y,z] [x,y,z] , given by: a rotation of -\\eta -\\eta then a rotation of -\\alpha -\\alpha and finally a rotation of -\\beta -\\beta : [x,y,z]^T=R_x(-\\beta)R_y(-\\alpha)R_z(-\\eta)[0,1,0]^T [x,y,z]^T=R_x(-\\beta)R_y(-\\alpha)R_z(-\\eta)[0,1,0]^T Plotting pole/planes Poles (or directions) can be additionally plotted. Add a pole or all the symmetric ones by pressing Symmetry after entering the indices comma separated. A Plane or all their symmetric, Sym Plane can be drawn. A Cone can be drawn by specifying its aperture angle. Iso-schmid factor lines can be plotted by specifying the plane in the pole/plane field and by pressing the Schmid button. The straining axis is here parallel to the \\alpha \\alpha -tilt axis. Further explanation will be given here Finally inter-reticular distances are given by entering a plane normal on the pole/plane field and by pressing dhkl button. The value appears in a field near the button. Layout Several layout options have been already discussed. Additional ones are presented here. Colors can be set for poles or planes plotted. Open symbols can be drawn by ticking the open/filled box (default are filled symbols) Wulff net can be drawn if the Wulff net box is ticked Marker size and text size can be indicated in the corresponding fields [uvw] [uvw] can be displayed by ticking the uvw box and replotting. For hexagonal structure, the hexa box can be selected to let the 4 indices notations. Hexagonal structure and notation For hexagonal structure it is more convenient to represent directions or planes using a basis with 4 integer indices than using the conventional cartesian basis. This basis is composed of the 3 vectors \\vec{a}_i \\vec{a}_i separated by 120\u00b0 angles and the \\vec{c} \\vec{c} perpendicular to the \\vec{a}_i \\vec{a}_i vectors. Hence any directions is given by [uvtw] [uvtw] with t=-u-v t=-u-v . In the reciprocal space, a plane is represented by (hkil) (hkil) with i=-h-k i=-h-k . Transforming indices from the 3 (HKL) (HKL) indices to 4 (hkil) indices is straightforward for planes as H=h H=h , K=k K=k , L=l L=l . For directions, [UVW] [UVW] we have the relationships, U=2u+v U=2u+v , V=2v+u V=2v+u and W=w W=w or u=1/3(2U-V) u=1/3(2U-V) , v=1/3(2V-U) v=1/3(2V-U) and w=W w=W . Note that with the four indices notations, directions are perpendicular to plane normals (i.e. contain in a plane) if (hkil)\\cdot[uvtw]=0 (hkil)\\cdot[uvtw]=0 as shown for instance below Note that for Euler angles convention, \\langle a \\rangle \\langle a \\rangle is parallel to x x and \\langle c \\rangle \\langle c \\rangle is parallel to z z at (0,0,0) (0,0,0) . Except uvw and colors, the above features can be updated by clicking the Update/Reset view button. click a pole/directions By right clicking on the stereographic projection, poles or directions (if uvw is ticked) will be displayed. Make Ctrl+z to remove the last click Additional features They are accessible from the menu bar. Save Stereographic plots can be saved as image with png format. Angle Angles between two poles (or two directions if the uvw button is ticked) can be computed by entering them in the field n1 and n2 (comma separated). The result appears after pressing OK . Cancel to quit. Schmid factor Schmid factors can be computed by entering both \\vec{b} \\vec{b} (as a direction), plane normal \\vec{n} \\vec{n} and straining axis \\vec{T} \\vec{T} . \\vec{T} \\vec{T} should be expressed in the holder coordinates before the alpha-tilt/y angle applies. After pressing OK , the Schmid factor appear below the the T T field. In the box below appear all possible slip systems n , b , with their Schmid factor values s . Schimd factor For a crystal strained along a tensile axis \\vec{T} \\vec{T} with a stress \\sigma \\sigma , dislocation slip on plane \\vec{n} \\vec{n} with the Burgers vector \\vec{b} \\vec{b} will appear if the resolved shear stress on the plane rises a critical value, i.e. $$ \\tau_c=\\sigma \\cos {(\\vec{n},\\vec{T})} \\cos{(\\vec{b},\\vec{T})} $$ Thus, the most favored slip system should be the one with the highest Schmid factor i.e., m=\\cos{(\\vec{n},\\vec{T})} \\cos{(\\vec{b},\\vec{T})} m=\\cos{(\\vec{n},\\vec{T})} \\cos{(\\vec{b},\\vec{T})} . For dislocation glide, m m should range between 0 and 0.5 xyz directions x,y,z x,y,z directions can be determined in the calculate xyz directions menu. Simply press update . The values indicated correspond to poles (i.e. in reciprocal space). Copy, paste in the pole/plane field and Add to plot. To get directions, use the hkl uvw menu. Press To uvw or To hkl to make the conversion. Then, copy and paste the result in the same way except uvw box need to be ticked. List A list of plotted poles/directions can be displayed using the show list poles/directions menu. When the Update list button is pressed the list is printed in a table showing in columns: indices a sign o for plotted or x for hidden hkl for a pole and uvw for a direction Poles/directions can be hidden or shown by selecting the corresponding rows and by clicking on Add/Remove selected button. Then the signs o or x change. Planes or cones of the given poles/directions will be hidden/shown if the plane or cone box is checked. If the list is updated, then the hidden poles/directions are deleted. An easier navigation in the crystal space can be achieved by determining the tilt sequence to reach either a given two beam condition or a zone axis. The angles are indicated in the last table column when pressing the Compute tilt button. If the ZA (zone axis) button is ticked, the \\alpha \\alpha -tilt and either \\beta \\beta tilt or \\theta \\theta tilt needed to reach the corresponding zone axis are computed. The corresponding \\beta \\beta or \\theta \\theta tilt button needs to be selected. If the ZA button is not selected, the \\alpha \\alpha tilt angle needed to have a given pole/direction perpendicular to the electron beam (may correspond to a 2 beam condition) can be computed for a given \\beta \\beta or \\theta \\theta tilt angle. Width Using calculate apparent width menu allows to plot the apparent width and apparent trace directions of an interface, when the sample is tilted along the \\alpha \\alpha -tilt axis from -40\u00b0 to 40\u00b0. More precision on the method will be given in interface . First, indicate the plane . The foil surface may be indicated if the box right to the box is ticked. The sample thickness may be indicated in nm if the box is checked . If not, the apparent width is normalized by the interface width d d . The trace dir. can be plotted if the box is checked with a blue overlay. Note that if several plots are made, which can be sometimes convenient, they will be superimposed. To erase the plots, click the clear button. Intersections Several intersections can be calculated through the calculate intersections menu. In the different cases results will appear by pressing OK . Results shown correspond to poles except if the directions box is ticked. intersections between two planes n1 and n2 . intersections between a plane n1 and the direction in the (x,y) (x,y) plane making a given angle with the Oy Oy direction indicated by an angle (\u00b0). intersections between a plane n1 and a cone c of a given angle aperture indicated by the inclination angle (\u00b0). If no solution, nan will appear. Diffraction The plot Kikuchi lines and diffraction pattern menu allows simple diffraction features drawing. They can be accessed through the button Diffraction or Kikuchi , after setting a crystal and an orientation (see above). Diffraction pattern The following parameters are needed: Acceleration voltage: E(kv) Aperture angle determining the extension in (\u00b0) viewed in the reciprocal space Max indices determining the extension of the reciprocal space calculated Spot size (arb. units) determining a scaling factor in the intensity Thckness is the sample thickness in nm Excitation error in 1/nm Click on Diff calc. button to compute the intensity of every reflexion (see diffraction for more details) Click then on OK button to draw the diffraction pattern. Update the drawing by clicking OK if the orientation is changed. Tick the label box to show indices (for hexagonal crystal, 3 indices are used). Diffraction pattern simulation When an incoming electron wave of wavelength \\lambda \\lambda and a wave vector \\vec{k} \\vec{k} hits a crystal plane, it will be elastically diffracted in a direction given by the wave vector \\vec{k}_g \\vec{k}_g , with the relation: $$ \\vec{k}_g=\\vec{k}+\\vec{g} $$ or equivalently $$ 2d\\sin{\\theta_B}=\\lambda $$ where \\theta_B \\theta_B is the Bragg angle and d d the interplanar distance defined by the \\vec{g} \\vec{g} vector. When the crystal is tilted away from the Bragg condition, diffraction ceases but not abruptly. To determine the decrease of the intensity, we need to define the vector \\vec{s} \\vec{s} which norm is called the excitation error, as shown below. Kinematical calculations show that: I = \\frac{\\pi^2}{\\xi^2}\\frac{\\sin^2{(\\pi s_e t)}}{( \\pi s_e )^2} I = \\frac{\\pi^2}{\\xi^2}\\frac{\\sin^2{(\\pi s_e t)}}{( \\pi s_e )^2} where t t is the crystal thickness, \\xi \\xi the extinction distance, which indicates how the diffracted electron wave oscillates through the crystal, and the s_e= \\sqrt{(s^2 + 1/\\xi^2)} s_e= \\sqrt{(s^2 + 1/\\xi^2)} the effective excitation error. For a given orientation, the excitation error s s can be computed for every possible diffraction vectors, and then their corresponding intensity. Kikuchi lines Kikuchi lines results from inelastic scattering in the sample and will be more discussed in the Kikuchi section . They can be plotted by selecting Kikuchi button. The following parameters are needed: Acceleration voltage: E(kv) Aperture angle determining the extension in (\u00b0) viewed in the reciprocal space Max indices determining the number of bands calculated Click on Diff calc. button to compute the intensity of the band. Click then on OK button to draw the Kikuchi pattern. Update the drawing by clicking OK if the orientation is changed. Change the Aperture angle to view a larger pattern. Tick the label box to show indices (for hexagonal crystal, 3 indices are used). Kikuchi band formation When inelastically scattered electrons are in Bragg condition, they will diffract, but because they can come from directions, they will be scattered in a cone around \\vec{g} \\vec{g} . As there are two diffraction directions ( \\pm \\vec{g} \\pm \\vec{g} ), two cones will form, one being brighter and the other darker than the background. When hitting the observation screen, they will form pairs of lines which separation width is proportional to the inter-planar distance d d . Their projection is called gnomomic, i.e. a point of coordinate (x,y,z) (x,y,z) will become (X,Y) (X,Y) with X = x/z X = x/z and Y = y / z Y = y / z . Here, to mimic the kinematical approximation, the line widths are proportional to the intensity of the corresponding diffraction vector and the intensity difference between the lines are not taken into account. In the reference frame, the vector (0,1,0) (0,1,0) is first rotated along z z by an angle \\eta \\eta and then along y y by an angle \\alpha \\alpha , the rotation axes being fixed. The definition proposed here differs from the usual spherical coordinates that refers on azimuthal and elevation angles. These names usually refers in geography to lines of given longitude and latitude connecting north and south poles. Here the lines connect east and west poles of the sphere. As meridians pass by two poles, they correspond to full circles on the sphere. Contrary parallels (except the equator) correspond to smaller circles on the sphere. Meridians result then from the intersection of planes with the sphere and parallels from the intersection of cones of given aperture. We consider active rotations and rotation matrix acting by pre-multiplying column vectors.","title":"StereoProj"},{"location":"stereoproj/#stereographic-projections","text":"A stereographic projection is a type of projection that maps a unit sphere onto a plane. It is a conformal projection, which means it preserves the angles. Stereographic projections are often use for practical reason in crystallography to display symmetry elements. This is an essential tool for electron microscopists who want to analyze microstructures. Traditionally projections are drawn by hand with the help of a Wulff net.","title":"Stereographic projections"},{"location":"stereoproj/#construction","text":"Let consider the south pole S S of a sphere lying in a (x,y,z) (x,y,z) coordinate system. A point M M in the upper hemisphere of the sphere can be projected on M' M' defined as the intersection between the line MS MS and the equatorial plane, i.e the plane that cuts the sphere at z=0 z=0 . Projection convention From a geometrical construction, points in the lower hemisphere ( z z negative) do not appear. They can alternatively be projected on the plane from the north pole instead. Opposite 3D directions, will then have opposite coordinates in the projection planes. In stereoproj we choose to discard points from the lower hemisphere. From this construction, it results several important features: 3D directions (x_0,y_0,z_0) (x_0,y_0,z_0) are projected into points of coordinates (X_0,Y_0) (X_0,Y_0) such as X_0= \\frac{x_0}{1+z_0} \\ Y_0=\\frac{y_0}{1+z_0} X_0= \\frac{x_0}{1+z_0} \\ Y_0=\\frac{y_0}{1+z_0} circles on the sphere, which correspond to 3D planes (full circles) or cones (smaller circles), are projected as portion or full circles. the north pole is located at the center of the stereographic projection the equatorial plane is projected as a great circle that bounds the stereograpic projection. any 3D direction can be defined by two angles 1 that we can choose as their inclination angle \\eta \\eta with respect to the Oy Oy direction and tilt angle \\alpha \\alpha with respect to the reference equatorial plane.","title":"Construction"},{"location":"stereoproj/#the-wulff-net","text":"The Wulff net results from the projection of equally distributed planes called meridians and parallels 2 . The first ones correspond to planes of a given tilt angle, the second corresponds to planes of a given inclination angle 3 . In stereoproj , meridians and parallels can be displayed and are spaced every 2\u00b0 with thicker lines every 10\u00b0. Meridians and parallels forming a Wulff net. Definition of the inclination and tilt angles","title":"The Wulff net"},{"location":"stereoproj/#euler-angles","text":"The orientation of a crystal can be set by 3 angles. Indeed given a direction, defined by two angles, the orientation can be fixed after rotating along this direction. A second standard definition of orientation is set by the Euler angles (\\varphi_1, \\phi, \\varphi_2) (\\varphi_1, \\phi, \\varphi_2) . In crystallography, it is traditionally adopted, according to Bunge, that it corresponds to: a rotation along the z z of axis \\varphi_1 \\varphi_1 a rotation along x' x' of \\phi \\phi a rotation along z' z' of \\varphi_2 \\varphi_2 . In the example below: (\\varphi_1,\\phi,\\varphi_2)=(-80,40,30) (\\varphi_1,\\phi,\\varphi_2)=(-80,40,30) Definition of the Euler angles, represented on the stereographic projection and in 3D. Points on the projections indicate the x,y,z x,y,z directions. Rotation matrices and Euler angles The orientation is defined by a rotation matrix that links the reference frame (x,y,z) (x,y,z) to the crystal frame (x',y',z') (x',y',z') by composing the 3 rotations. In the example shown, it was considered that the rotations operate sequentially in a moving frame: they are called intrinsic. This definition is however not convenient for working with rotation matrices as the rotation axes move in the reference frame. So, we can define the Euler angles from extrinsic rotations, i.e. rotations that operate in the fixed reference frame (x,y,z) (x,y,z) , in the way presented in the figure below for (\\varphi_1,\\phi,\\varphi_2)=(-80,40,30) (\\varphi_1,\\phi,\\varphi_2)=(-80,40,30) . This corresponds to: a rotation along z z of an angle \\varphi_2 \\varphi_2 , a rotation along x x of \\phi \\phi and a rotation along z z of \\varphi_1 \\varphi_1 , i.e. 4 : $$ R=R_z(\\varphi_1)R_x(\\phi)R_z(\\varphi_2) $$ where R_z(a) R_z(a) and R_x(a) R_x(a) are the rotation matrices along x x and z z axis of an angle a a . Inversely, knowing the rotation matrix, the Euler angles can be determined: $$ \\varphi_1 = \\arctan(R_{02}/R_{12}), \\phi = \\arccos(R_{22}), \\varphi_2 = \\arctan(R_{20}/R_{21}) $$ However, when \\phi=0 (\\pi) \\phi=0 (\\pi) , the angles \\varphi_2 \\varphi_2 and \\varphi_1 \\varphi_1 are not defined independently, i.e. because they share a common rotation axis. This phenomena is known as gimbal lock and can be resolved by setting \\phi = 0 \\phi = 0 , \\varphi_1 = 0 \\varphi_1 = 0 and \\varphi_2 = \\arctan(R_{10}/R_{00}) \\varphi_2 = \\arctan(R_{10}/R_{00})","title":"Euler angles"},{"location":"stereoproj/#coordinate-systems","text":"Coordinate system of the sample is given by the axes (x,y,z) (x,y,z) as shown in the figure below. The y y axis corresponds to the primary tilt axis called \\alpha \\alpha -tilt axis. The x x direction corresponds to the secondary tilt axis called \\beta \\beta -tilt axis for a double tilt sample holder. The z z direction is anti-parallel with the electron beam. It corresponds to the rotation axis for a tilt-rotation sample holder. By default, the rotation angles are taken positive in the clockwise sense, i.e. right handed. The sample, and then the crystal, can be rotated around the tilt axes. Rotation steps are 5\u00b0 by default. The value of rotation angle are indicated. The sense of rotation can be changed by ticking the AC (anti-clockwise) box. The Reset button allows to reset the values displayed. When the Lock Axes box is checked, the x x and z z axes are now fixed with the sample, in order to mimic the behavior of double tilt and tilt-rotation holder. Rotation in double tilt When the axes are fixed in the microscope frame (x,y,z) (x,y,z) , the rotation order matters. However when the x x axis is fixed in the sample frame and y y fixed in the microscope frame, the two operations are commutative. In terms of rotation matrices, we have: R_y(\\alpha)R_x(\\beta)=R_u(\\beta)R_y(\\alpha) \\\\ u=R_y(\\alpha) [1,0,0]~^T R_y(\\alpha)R_x(\\beta)=R_u(\\beta)R_y(\\alpha) \\\\ u=R_y(\\alpha) [1,0,0]~^T Same conclusions hold for tilt-rotation holder. Top: rotation with fixed rotation axes, Bottom: rotation with a fixed y y tilt and moving x x tilt. Red and blue paths represent a switch in the tilt order. Crystallographic feature analyses are carried out in a TEM using both diffraction and image mode. When the electrons passing through the specimen are focused in the back focal plane of the objective lens, they form a diffraction pattern which can be magnified in the projection plane where the pattern is recorded. Conversely, an image is formed in the first image plane of the objective lens, which can also be magnified in the projected lens. To switch from image to diffraction mode, the power of the objective lens has to be modified which induces an image rotation. To enlarge the pattern or the image, the effect of intermediate and projection lenses may also introduce rotations. For this reason, the holder coordinate system does not correspond to the coordinate system as viewed in the recorded image or diffraction patterns. Users need thus to determine the relation between the two. In image mode, the position of the \\alpha \\alpha -tilt axis with respect to the Y Y axis, represented by an angle \\delta \\delta , can be determined by pushing or pulling on the holder and recording the motion of features on the image. In diffraction mode, the position of the \\alpha \\alpha -tilt axis with respect to the Y Y axis, represented by an angle \\xi \\xi , can be determined by rotating the crystal and recording the displacement of the Kikuchi bands, which will be perpendicular to the rotation axis. 180\u00b0 rotation Because images and diffraction patterns are naturally inverted because of the objective lens, there usually exists a 180\u00b0 rotation between image and diffraction modes. In some cases, this extra rotation needs to be taken into account, i.e. when we care about (h,k,l) (h,k,l) or (\\bar{h},\\bar{k},\\bar{l}) (\\bar{h},\\bar{k},\\bar{l}) . This can be solved by inspecting the sense of displacement of the Kikuchi lines with respect to the tilt angle, or by inspecting how the image is inverted or not in diffraction mode, compared to image mode, when under or over-focusing the diffraction lens. Because it is easier to navigate in the stereographic projection when knowing either the angle \\delta \\delta , in reciprocal space or \\xi \\xi in direct space, the rotation angle in image and diffraction mode can be indicated in the diff alpha/y-angle and image alpha/y angle fields. Tick the img/diff box to switch to image mode. When the view is updated, the tilting axes (and Wulff net) are rotated accordingly along the z z axis as illustrated in the picture below. Note Note that the Euler angles are always defined in the (x,y,z) (x,y,z) holder coordinates. However, rotation along the \\alpha \\alpha , \\beta \\beta and \\theta \\theta axes will now be updated.","title":"Coordinate systems"},{"location":"stereoproj/#interface","text":"The interface is composed of a top menu bar, the plotting area and the plotting panel. Zoom and pan are available in the plotting area. Click on the update/reset view button to restore the full view.","title":"Interface"},{"location":"stereoproj/#plotting-procedure","text":"","title":"Plotting procedure"},{"location":"stereoproj/#setting-up-the-crystal","text":"Stereographic projection reflects the symmetry of a given lattice system which depends on the lattice parameters a,b,c a,b,c and the angles \\alpha \\alpha , \\beta \\beta and \\gamma \\gamma of the cell. a,b,c a,b,c and \\alpha, \\beta, \\gamma \\alpha, \\beta, \\gamma can be set up in the Crystal parameters . Info A crystal direction expressed by their Miller indices are related to Cartesian coordinates, in the crystal frame, by: \\begin{bmatrix}x\\\\ y \\\\ z \\end{bmatrix}=D \\begin{bmatrix}u \\\\ v \\\\ w \\end{bmatrix} \\begin{bmatrix}x\\\\ y \\\\ z \\end{bmatrix}=D \\begin{bmatrix}u \\\\ v \\\\ w \\end{bmatrix} with D= \\begin{pmatrix} a b \\cos \\gamma c \\cos \\beta \\\\ 0 b \\sin \\gamma c (\\cos \\alpha - \\cos \\beta \\cos \\gamma)/ \\sin \\gamma\\\\ 0 0 V/(a b \\sin \\gamma) \\end{pmatrix} D= \\begin{pmatrix} a & b \\cos \\gamma & c \\cos \\beta \\\\ 0 & b \\sin \\gamma & c (\\cos \\alpha - \\cos \\beta \\cos \\gamma)/ \\sin \\gamma\\\\ 0 & 0 & V/(a b \\sin \\gamma) \\end{pmatrix} V V being the crystal volume V = a b c \\sqrt {1 - \\cos^2\\alpha - \\cos^2 \\beta - \\cos^2 \\gamma + 2 \\cos \\alpha \\cos \\beta \\cos \\gamma } V = a b c \\sqrt {1 - \\cos^2\\alpha - \\cos^2 \\beta - \\cos^2 \\gamma + 2 \\cos \\alpha \\cos \\beta \\cos \\gamma } Inversely in the reciprocal space, poles, i.e. normal to planes are related by: \\begin{pmatrix}x\\\\ y \\\\ z \\end{pmatrix}=D^\\ast \\begin{pmatrix}h \\\\ k \\\\ l \\end{pmatrix} \\begin{pmatrix}x\\\\ y \\\\ z \\end{pmatrix}=D^\\ast \\begin{pmatrix}h \\\\ k \\\\ l \\end{pmatrix} with D^\\ast= (D^{-1}) ~^T D^\\ast= (D^{-1}) ~^T . The metric of the crystal G G allows to measure distance in direct and reciprocal space. The inter-reticular spacing for a plane (h,k,l) (h,k,l) for instance is given by: d_{hkl}=\\frac{1}{d^\\ast_{hkl}}=\\frac{1}{\\sqrt{(h \\ k \\ l)G^\\star (h \\ k \\ l)~^T}} d_{hkl}=\\frac{1}{d^\\ast_{hkl}}=\\frac{1}{\\sqrt{(h \\ k \\ l)G^\\star (h \\ k \\ l)~^T}} with G^\\ast=D^\\ast~^T D^\\ast G^\\ast=D^\\ast~^T D^\\ast Change the number of pole/direction drawn by increasing or decreasing the value of d and/or by changing the maximum indices . Crystal structure can be imported from the structure menu. This menu can be populated by adding structures in the structure.txt files following the template: Name a(A) b(A) c(A) alpha beta gamma space group The space group is defined in the space_group.txt file following the scheme: Name Atom name1 x1 y1 z1 Atom name1 x2 y2 z2 ... Atom name2 x3 y3 z3 Additionally, atoms need to be defined in the scattering.txt file (see diffraction for more details). From diffraction, crystals with different space groups (even with the same lattice system) present diffraction vectors, i.e. in the reciprocal space, with different intensities. Filling the space group field and ticking the reciprocal indices box will allow to plot poles with sizes proportional to their intensity (see the diffraction page for more details). Example for a TiAl crystal","title":"Setting up the crystal"},{"location":"stereoproj/#from-euler-angles","text":"Stereographic projections can be drawn from the 3 Euler angles. The angles can be read at all time after rotation operations. Tilt and inclination angles can be read from the mouse position on the Wulff net.","title":"From Euler angles"},{"location":"stereoproj/#from-a-diffraction-vector","text":"The orientation can be alternatively set the following way: choose a diffraction vector (h,k,l) (h,k,l) (see diffraction to determine it) set its inclination \\eta \\eta and tilt angles \\alpha \\alpha , \\beta \\beta , \\theta \\theta (comma separated) adjust a second diffraction vector by rotating around the first vector Multiple tilting axes When considering a diffraction vector obtained after double tilt ( \\alpha \\alpha and \\beta \\beta ) or after tilt-rotation ( \\alpha \\alpha , \\theta \\theta ), the diffraction vector should be placed on the stereographic projection taking into account the fact that the \\beta \\beta (or \\theta \\theta ) -tilt axis moves with the holder while \\alpha \\alpha -tilt is fixed. For instance, if the (1,1,1) (1,1,1) diffraction vector is recorded at (\\alpha,\\beta,\\theta)=(10,-20,0) (\\alpha,\\beta,\\theta)=(10,-20,0) with an inclination of \\eta=40 \\eta=40 , the diffraction is placed such that after rotating first by \\beta=-20 \\beta=-20 and second by \\alpha=10 \\alpha=10 it forms an angle \\eta=40 \\eta=40 with the y y direction on the diffraction pattern (owing that there is no rotation between the \\alpha \\alpha tilt axis and the y y direction). This means that in the sample frame, the diffraction vector coordinates are, starting from [0,1,0] [0,1,0] , in the direction [x,y,z] [x,y,z] , given by: a rotation of -\\eta -\\eta then a rotation of -\\alpha -\\alpha and finally a rotation of -\\beta -\\beta : [x,y,z]^T=R_x(-\\beta)R_y(-\\alpha)R_z(-\\eta)[0,1,0]^T [x,y,z]^T=R_x(-\\beta)R_y(-\\alpha)R_z(-\\eta)[0,1,0]^T","title":"From a diffraction vector"},{"location":"stereoproj/#plotting-poleplanes","text":"Poles (or directions) can be additionally plotted. Add a pole or all the symmetric ones by pressing Symmetry after entering the indices comma separated. A Plane or all their symmetric, Sym Plane can be drawn. A Cone can be drawn by specifying its aperture angle. Iso-schmid factor lines can be plotted by specifying the plane in the pole/plane field and by pressing the Schmid button. The straining axis is here parallel to the \\alpha \\alpha -tilt axis. Further explanation will be given here Finally inter-reticular distances are given by entering a plane normal on the pole/plane field and by pressing dhkl button. The value appears in a field near the button.","title":"Plotting pole/planes"},{"location":"stereoproj/#layout","text":"Several layout options have been already discussed. Additional ones are presented here. Colors can be set for poles or planes plotted. Open symbols can be drawn by ticking the open/filled box (default are filled symbols) Wulff net can be drawn if the Wulff net box is ticked Marker size and text size can be indicated in the corresponding fields [uvw] [uvw] can be displayed by ticking the uvw box and replotting. For hexagonal structure, the hexa box can be selected to let the 4 indices notations. Hexagonal structure and notation For hexagonal structure it is more convenient to represent directions or planes using a basis with 4 integer indices than using the conventional cartesian basis. This basis is composed of the 3 vectors \\vec{a}_i \\vec{a}_i separated by 120\u00b0 angles and the \\vec{c} \\vec{c} perpendicular to the \\vec{a}_i \\vec{a}_i vectors. Hence any directions is given by [uvtw] [uvtw] with t=-u-v t=-u-v . In the reciprocal space, a plane is represented by (hkil) (hkil) with i=-h-k i=-h-k . Transforming indices from the 3 (HKL) (HKL) indices to 4 (hkil) indices is straightforward for planes as H=h H=h , K=k K=k , L=l L=l . For directions, [UVW] [UVW] we have the relationships, U=2u+v U=2u+v , V=2v+u V=2v+u and W=w W=w or u=1/3(2U-V) u=1/3(2U-V) , v=1/3(2V-U) v=1/3(2V-U) and w=W w=W . Note that with the four indices notations, directions are perpendicular to plane normals (i.e. contain in a plane) if (hkil)\\cdot[uvtw]=0 (hkil)\\cdot[uvtw]=0 as shown for instance below Note that for Euler angles convention, \\langle a \\rangle \\langle a \\rangle is parallel to x x and \\langle c \\rangle \\langle c \\rangle is parallel to z z at (0,0,0) (0,0,0) . Except uvw and colors, the above features can be updated by clicking the Update/Reset view button. click a pole/directions By right clicking on the stereographic projection, poles or directions (if uvw is ticked) will be displayed. Make Ctrl+z to remove the last click","title":"Layout"},{"location":"stereoproj/#additional-features","text":"They are accessible from the menu bar.","title":"Additional features"},{"location":"stereoproj/#save","text":"Stereographic plots can be saved as image with png format.","title":"Save"},{"location":"stereoproj/#angle","text":"Angles between two poles (or two directions if the uvw button is ticked) can be computed by entering them in the field n1 and n2 (comma separated). The result appears after pressing OK . Cancel to quit.","title":"Angle"},{"location":"stereoproj/#schmid-factor","text":"Schmid factors can be computed by entering both \\vec{b} \\vec{b} (as a direction), plane normal \\vec{n} \\vec{n} and straining axis \\vec{T} \\vec{T} . \\vec{T} \\vec{T} should be expressed in the holder coordinates before the alpha-tilt/y angle applies. After pressing OK , the Schmid factor appear below the the T T field. In the box below appear all possible slip systems n , b , with their Schmid factor values s . Schimd factor For a crystal strained along a tensile axis \\vec{T} \\vec{T} with a stress \\sigma \\sigma , dislocation slip on plane \\vec{n} \\vec{n} with the Burgers vector \\vec{b} \\vec{b} will appear if the resolved shear stress on the plane rises a critical value, i.e. $$ \\tau_c=\\sigma \\cos {(\\vec{n},\\vec{T})} \\cos{(\\vec{b},\\vec{T})} $$ Thus, the most favored slip system should be the one with the highest Schmid factor i.e., m=\\cos{(\\vec{n},\\vec{T})} \\cos{(\\vec{b},\\vec{T})} m=\\cos{(\\vec{n},\\vec{T})} \\cos{(\\vec{b},\\vec{T})} . For dislocation glide, m m should range between 0 and 0.5","title":"Schmid factor"},{"location":"stereoproj/#xyz-directions","text":"x,y,z x,y,z directions can be determined in the calculate xyz directions menu. Simply press update . The values indicated correspond to poles (i.e. in reciprocal space). Copy, paste in the pole/plane field and Add to plot. To get directions, use the hkl uvw menu. Press To uvw or To hkl to make the conversion. Then, copy and paste the result in the same way except uvw box need to be ticked.","title":"xyz directions"},{"location":"stereoproj/#list","text":"A list of plotted poles/directions can be displayed using the show list poles/directions menu. When the Update list button is pressed the list is printed in a table showing in columns: indices a sign o for plotted or x for hidden hkl for a pole and uvw for a direction Poles/directions can be hidden or shown by selecting the corresponding rows and by clicking on Add/Remove selected button. Then the signs o or x change. Planes or cones of the given poles/directions will be hidden/shown if the plane or cone box is checked. If the list is updated, then the hidden poles/directions are deleted. An easier navigation in the crystal space can be achieved by determining the tilt sequence to reach either a given two beam condition or a zone axis. The angles are indicated in the last table column when pressing the Compute tilt button. If the ZA (zone axis) button is ticked, the \\alpha \\alpha -tilt and either \\beta \\beta tilt or \\theta \\theta tilt needed to reach the corresponding zone axis are computed. The corresponding \\beta \\beta or \\theta \\theta tilt button needs to be selected. If the ZA button is not selected, the \\alpha \\alpha tilt angle needed to have a given pole/direction perpendicular to the electron beam (may correspond to a 2 beam condition) can be computed for a given \\beta \\beta or \\theta \\theta tilt angle.","title":"List"},{"location":"stereoproj/#width","text":"Using calculate apparent width menu allows to plot the apparent width and apparent trace directions of an interface, when the sample is tilted along the \\alpha \\alpha -tilt axis from -40\u00b0 to 40\u00b0. More precision on the method will be given in interface . First, indicate the plane . The foil surface may be indicated if the box right to the box is ticked. The sample thickness may be indicated in nm if the box is checked . If not, the apparent width is normalized by the interface width d d . The trace dir. can be plotted if the box is checked with a blue overlay. Note that if several plots are made, which can be sometimes convenient, they will be superimposed. To erase the plots, click the clear button.","title":"Width"},{"location":"stereoproj/#intersections","text":"Several intersections can be calculated through the calculate intersections menu. In the different cases results will appear by pressing OK . Results shown correspond to poles except if the directions box is ticked. intersections between two planes n1 and n2 . intersections between a plane n1 and the direction in the (x,y) (x,y) plane making a given angle with the Oy Oy direction indicated by an angle (\u00b0). intersections between a plane n1 and a cone c of a given angle aperture indicated by the inclination angle (\u00b0). If no solution, nan will appear.","title":"Intersections"},{"location":"stereoproj/#diffraction","text":"The plot Kikuchi lines and diffraction pattern menu allows simple diffraction features drawing. They can be accessed through the button Diffraction or Kikuchi , after setting a crystal and an orientation (see above).","title":"Diffraction"},{"location":"stereoproj/#diffraction-pattern","text":"The following parameters are needed: Acceleration voltage: E(kv) Aperture angle determining the extension in (\u00b0) viewed in the reciprocal space Max indices determining the extension of the reciprocal space calculated Spot size (arb. units) determining a scaling factor in the intensity Thckness is the sample thickness in nm Excitation error in 1/nm Click on Diff calc. button to compute the intensity of every reflexion (see diffraction for more details) Click then on OK button to draw the diffraction pattern. Update the drawing by clicking OK if the orientation is changed. Tick the label box to show indices (for hexagonal crystal, 3 indices are used). Diffraction pattern simulation When an incoming electron wave of wavelength \\lambda \\lambda and a wave vector \\vec{k} \\vec{k} hits a crystal plane, it will be elastically diffracted in a direction given by the wave vector \\vec{k}_g \\vec{k}_g , with the relation: $$ \\vec{k}_g=\\vec{k}+\\vec{g} $$ or equivalently $$ 2d\\sin{\\theta_B}=\\lambda $$ where \\theta_B \\theta_B is the Bragg angle and d d the interplanar distance defined by the \\vec{g} \\vec{g} vector. When the crystal is tilted away from the Bragg condition, diffraction ceases but not abruptly. To determine the decrease of the intensity, we need to define the vector \\vec{s} \\vec{s} which norm is called the excitation error, as shown below. Kinematical calculations show that: I = \\frac{\\pi^2}{\\xi^2}\\frac{\\sin^2{(\\pi s_e t)}}{( \\pi s_e )^2} I = \\frac{\\pi^2}{\\xi^2}\\frac{\\sin^2{(\\pi s_e t)}}{( \\pi s_e )^2} where t t is the crystal thickness, \\xi \\xi the extinction distance, which indicates how the diffracted electron wave oscillates through the crystal, and the s_e= \\sqrt{(s^2 + 1/\\xi^2)} s_e= \\sqrt{(s^2 + 1/\\xi^2)} the effective excitation error. For a given orientation, the excitation error s s can be computed for every possible diffraction vectors, and then their corresponding intensity.","title":"Diffraction pattern"},{"location":"stereoproj/#kikuchi-lines","text":"Kikuchi lines results from inelastic scattering in the sample and will be more discussed in the Kikuchi section . They can be plotted by selecting Kikuchi button. The following parameters are needed: Acceleration voltage: E(kv) Aperture angle determining the extension in (\u00b0) viewed in the reciprocal space Max indices determining the number of bands calculated Click on Diff calc. button to compute the intensity of the band. Click then on OK button to draw the Kikuchi pattern. Update the drawing by clicking OK if the orientation is changed. Change the Aperture angle to view a larger pattern. Tick the label box to show indices (for hexagonal crystal, 3 indices are used). Kikuchi band formation When inelastically scattered electrons are in Bragg condition, they will diffract, but because they can come from directions, they will be scattered in a cone around \\vec{g} \\vec{g} . As there are two diffraction directions ( \\pm \\vec{g} \\pm \\vec{g} ), two cones will form, one being brighter and the other darker than the background. When hitting the observation screen, they will form pairs of lines which separation width is proportional to the inter-planar distance d d . Their projection is called gnomomic, i.e. a point of coordinate (x,y,z) (x,y,z) will become (X,Y) (X,Y) with X = x/z X = x/z and Y = y / z Y = y / z . Here, to mimic the kinematical approximation, the line widths are proportional to the intensity of the corresponding diffraction vector and the intensity difference between the lines are not taken into account. In the reference frame, the vector (0,1,0) (0,1,0) is first rotated along z z by an angle \\eta \\eta and then along y y by an angle \\alpha \\alpha , the rotation axes being fixed. The definition proposed here differs from the usual spherical coordinates that refers on azimuthal and elevation angles. These names usually refers in geography to lines of given longitude and latitude connecting north and south poles. Here the lines connect east and west poles of the sphere. As meridians pass by two poles, they correspond to full circles on the sphere. Contrary parallels (except the equator) correspond to smaller circles on the sphere. Meridians result then from the intersection of planes with the sphere and parallels from the intersection of cones of given aperture. We consider active rotations and rotation matrix acting by pre-multiplying column vectors.","title":"Kikuchi lines"}]}